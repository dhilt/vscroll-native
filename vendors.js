"use strict";(self.webpackChunkvscroll_native=self.webpackChunkvscroll_native||[]).push([[216],{940:(e,t,i)=>{i.d(t,{ZT:()=>r,pi:()=>o,mG:()=>s,Jh:()=>a,XA:()=>c,CR:()=>l,ev:()=>u});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var o=function(){return o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};function s(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function a(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function c(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function u(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}Object.create},265:(e,t,i)=>{i.d(t,{h4:()=>ri,cK:()=>z});var n,r,o=i(940),s=function(){function e(e,t){this.id=0,void 0!==e&&(this.value=e,this.initialValue=e),this.options=t||{},this.subscriptions=new Map}return e.prototype.set=function(e){var t,i;if(this.value!==e||this.options.emitEqual){this.value=e;try{for(var n=(0,o.XA)(this.subscriptions),r=n.next();!r.done;r=n.next()){if((0,o.CR)(r.value,2)[1].emit(e),this.value!==e)break}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}}},e.prototype.get=function(){return this.value},e.prototype.on=function(e){var t=this,i=this.id++,n={emit:e,off:function(){n.emit=function(){return null},t.subscriptions.delete(i)}};return this.subscriptions.set(i,n),this.options.emitOnSubscribe&&n.emit(this.value),function(){return n.off()}},e.prototype.once=function(e){var t=this.on((function(i){t(),e(i)}));return t},e.prototype.reset=function(){this.set(this.initialValue)},e.prototype.dispose=function(){this.subscriptions.forEach((function(e){return e.off()}))},e}();!function(e){e.id="id",e.mock="mock",e.augmented="augmented",e.version="version",e.init="init",e.init$="init$",e.packageInfo="packageInfo",e.itemsCount="itemsCount",e.bufferInfo="bufferInfo",e.isLoading="isLoading",e.isLoading$="isLoading$",e.loopPending="loopPending",e.loopPending$="loopPending$",e.firstVisible="firstVisible",e.firstVisible$="firstVisible$",e.lastVisible="lastVisible",e.lastVisible$="lastVisible$",e.bof="bof",e.bof$="bof$",e.eof="eof",e.eof$="eof$",e.reset="reset",e.reload="reload",e.append="append",e.prepend="prepend",e.check="check",e.remove="remove",e.clip="clip",e.insert="insert",e.replace="replace",e.update="update",e.fix="fix",e.relax="relax",e.showLog="showLog"}(n||(n={})),function(e){e[e.Scalar=0]="Scalar",e[e.Reactive=1]="Reactive",e[e.WorkflowRunner=2]="WorkflowRunner",e[e.Function=3]="Function"}(r||(r={}));var a,c,l,u=n,f=r,d=function(){return null},h={immediate:!0,success:!0,details:"Adapter is not initialized"},p=function(){return Promise.resolve(h)},g={core:{name:"",version:""},consumer:{name:"",version:""}},m={firstIndex:NaN,lastIndex:NaN,minIndex:NaN,maxIndex:NaN,absMinIndex:-1/0,absMaxIndex:1/0,defaultSize:NaN},v={data:{},element:{}},x=function(){return[{type:f.Scalar,name:u.id,value:0,permanent:!0},{type:f.Scalar,name:u.mock,value:!0,permanent:!0},{type:f.Scalar,name:u.augmented,value:!1,permanent:!0},{type:f.Scalar,name:u.version,value:"",permanent:!0},{type:f.Scalar,name:u.init,value:!1,reactive:u.init$},{type:f.Scalar,name:u.packageInfo,value:g,onDemand:!0},{type:f.Scalar,name:u.itemsCount,value:0,onDemand:!0},{type:f.Scalar,name:u.bufferInfo,value:m,onDemand:!0},{type:f.Scalar,name:u.isLoading,value:!1,reactive:u.isLoading$},{type:f.Scalar,name:u.loopPending,value:!1,reactive:u.loopPending$},{type:f.Scalar,name:u.firstVisible,value:v,reactive:u.firstVisible$,wanted:!0},{type:f.Scalar,name:u.lastVisible,value:v,reactive:u.lastVisible$,wanted:!0},{type:f.Scalar,name:u.bof,value:!1,reactive:u.bof$},{type:f.Scalar,name:u.eof,value:!1,reactive:u.eof$},{type:f.WorkflowRunner,name:u.reset,value:p},{type:f.WorkflowRunner,name:u.reload,value:p},{type:f.WorkflowRunner,name:u.append,value:p},{type:f.WorkflowRunner,name:u.prepend,value:p},{type:f.WorkflowRunner,name:u.check,value:p},{type:f.WorkflowRunner,name:u.remove,value:p},{type:f.WorkflowRunner,name:u.clip,value:p},{type:f.WorkflowRunner,name:u.insert,value:p},{type:f.WorkflowRunner,name:u.replace,value:p},{type:f.WorkflowRunner,name:u.update,value:p},{type:f.WorkflowRunner,name:u.fix,value:p},{type:f.Function,name:u.relax,value:d},{type:f.Function,name:u.showLog,value:d},{type:f.Reactive,name:u.init$,value:new s},{type:f.Reactive,name:u.isLoading$,value:new s},{type:f.Reactive,name:u.loopPending$,value:new s},{type:f.Reactive,name:u.firstVisible$,value:new s(v,{emitOnSubscribe:!0})},{type:f.Reactive,name:u.lastVisible$,value:new s(v,{emitOnSubscribe:!0})},{type:f.Reactive,name:u.bof$,value:new s},{type:f.Reactive,name:u.eof$,value:new s}]},y=new Map,b={name:"vscroll",version:"1.5.0"},w=0,I=function(e){var t=this,i=e.mock,s=e.reactive,a=++w,c={configurable:!0},l={};Object.defineProperty(this,n.id,(0,o.pi)({get:function(){return a}},c)),Object.defineProperty(this,n.mock,(0,o.pi)({get:function(){return i}},c)),Object.defineProperty(this,n.augmented,(0,o.pi)({get:function(){return!1}},c)),Object.defineProperty(this,n.version,(0,o.pi)({get:function(){return b.version}},c)),x().filter((function(e){return!e.permanent})).forEach((function(e){var i=e.name,n=e.value,a=e.type;if(s&&a===r.Reactive){var u=s[i];u&&(l[i]=(0,o.pi)((0,o.pi)({},u),{default:n}),n=u.source)}Object.defineProperty(t,i,(0,o.pi)({get:function(){return n}},c))})),s&&y.set(a,l)},S=function(){function e(e,t){this.get=e.get,e.settings&&(this.settings=e.settings),e.devSettings&&(this.devSettings=e.devSettings);var i=new I(t||{mock:!1});this.adapter=i}return e.prototype.dispose=function(){y.delete(this.adapter.id)},e}(),z=function(e){return function(t){function i(i){var n="function"==typeof e?e():void 0;return t.call(this,i,n)||this}return(0,o.ZT)(i,t),i}(S)},k=z();!function(e){e.forward="forward",e.backward="backward"}(a||(a={})),function(e){e.Average="average",e.Constant="constant",e.Frequent="frequent"}(c||(c={})),function(e){e.number="must be a number",e.integer="must be an integer",e.integerUnlimited="must be an integer or infinity",e.moreOrEqual="must be a number greater than (or equal to) {arg1}",e.itemList="must be an array of items {arg1}",e.boolean="must be a boolean",e.object="must be an object",e.element="must be an html element",e.function="must be a function",e.funcOfxArguments="must have {arg1} argument(s)",e.funcOfxAndMoreArguments="must have at least {arg1} argument(s)",e.funcOfXToYArguments="must have {arg1} to {arg2} arguments",e.oneOfCan="can be present as only one item of {arg1} list",e.oneOfMust="must be present as only one item of {arg1} list",e.or="must satisfy at least 1 validator from {arg1} list",e.enum="must belong to {arg1} list"}(l||(l={}));var E,V,M=function(e,t){return(t||[""]).reduce((function(e,t,i){return e.replace("{arg".concat(i+1,"}"),t)}),e)},N=function(e){return"number"==typeof e||"string"==typeof e&&""!==e?Number(e):NaN},O=function(e){var t=N(e),i=[];return Number.isNaN(t)&&i.push(l.number),{value:t,isSet:!0,isValid:!i.length,errors:i}},P=function(e,t){return function(i){var n=O(i);if(!n.isValid)return n;var r=n.value,o=[];return r<e&&(t?r=e:o.push(M(l.moreOrEqual,[String(e)]))),{value:r,isSet:!0,isValid:!o.length,errors:o}}},R=function(e){var t=[];return"function"!=typeof e&&t.push(l.function),{value:e,isSet:!0,isValid:!t.length,errors:t}},$=function(e,t){return function(i){var n=R(i);if(!n.isValid)return n;var r=[];return((i=n.value).length<e||i.length>t)&&r.push(M(l.funcOfXToYArguments,[String(e),String(t)])),{value:i,isSet:!0,isValid:!r.length,errors:r}}},C=function(e,t){return function(i,n){var r=[],o=void 0!==i,s=!o,a=t?l.oneOfMust:l.oneOfCan;if(Array.isArray(e)&&e.length){for(var c=e.length-1;c>=0;c--){var u=e[c];if("string"!=typeof u){r.push(M(a,[e.join('", "')])+" (non-string token)");break}var f=n&&Object.prototype.hasOwnProperty.call(n,u);if(o&&f){r.push(M(a,[e.join('", "')])+" (".concat(u," is present)"));break}s&&f&&(s=!1)}t&&s&&r.push(M(a,[e.join('", "')]))}else r.push(M(a,["undefined"]));return{value:i,isSet:o,isValid:!r.length,errors:r}}},A=function(e){return function(t){var i=[],n=Object.keys(e).filter((function(e){return isNaN(Number(e))})).map((function(t){return e[t]}));return n.some((function(e){return e===t}))||i.push(M(l.enum,["["+n.join(",")+"]"])),{value:t,isSet:!0,isValid:!i.length,errors:i}}},T={NUMBER:{type:l.number,method:O},INTEGER:{type:l.integer,method:function(e){var t=[];e=N(e);var i=parseInt(String(e),10);return e!==i&&t.push(l.integer),{value:i,isSet:!0,isValid:!t.length,errors:t}}},INTEGER_UNLIMITED:{type:l.integerUnlimited,method:function(e){var t=e,i=[];return(e=N(e))!==(t=Number.isFinite(e)?parseInt(String(e),10):e)&&i.push(l.integerUnlimited),{value:t,isSet:!0,isValid:!i.length,errors:i}}},MORE_OR_EQUAL:function(e,t){return{type:l.moreOrEqual,method:P(e,t)}},BOOLEAN:{type:l.boolean,method:function(e){var t=[],i=e;return"true"===e?i=!0:"false"===e&&(i=!1),"boolean"!=typeof i&&t.push(l.boolean),{value:i,isSet:!0,isValid:!t.length,errors:t}}},OBJECT:{type:l.object,method:function(e){var t=[];return"[object Object]"!==Object.prototype.toString.call(e)&&t.push(l.object),{value:e,isSet:!0,isValid:!t.length,errors:t}}},ITEM_LIST:{type:l.itemList,method:function(e){var t=e,i=[];if(Array.isArray(e))if(e.length){if(e.length>1)for(var n=typeof e[0],r=e.length-1;r>=0;r--)if(typeof e[r]!==n){i.push(M(l.itemList,["of items of the same type"]));break}}else i.push(M(l.itemList,["with at least 1 item"]));else i.push(l.itemList),t=[];return{value:t,isSet:!0,isValid:!i.length,errors:i}}},ELEMENT:{type:l.element,method:function(e){var t=[];return e instanceof Element||e instanceof HTMLDocument||t.push(l.element),{value:e,isSet:!0,isValid:!t.length,errors:t}}},FUNC:{type:l.function,method:R},FUNC_WITH_X_ARGUMENTS:function(e){return{type:l.funcOfxArguments,method:(t=e,function(e){var i=R(e);if(!i.isValid)return i;var n=[];return(e=i.value).length!==t&&n.push(M(l.funcOfxArguments,[String(t)])),{value:e,isSet:!0,isValid:!n.length,errors:n}})};var t},FUNC_WITH_X_AND_MORE_ARGUMENTS:function(e){return{type:l.funcOfxAndMoreArguments,method:(t=e,function(e){var i=R(e);if(!i.isValid)return i;var n=[];return(e=i.value).length<t&&n.push(M(l.funcOfxArguments,[String(t)])),{value:e,isSet:!0,isValid:!n.length,errors:n}})};var t},FUNC_WITH_X_TO_Y_ARGUMENTS:function(e,t){return{type:l.funcOfXToYArguments,method:$(e,t)}},ONE_OF_CAN:function(e){return{type:l.oneOfCan,method:C(e,!1)}},ONE_OF_MUST:function(e){return{type:l.oneOfMust,method:C(e,!0)}},OR:function(e){return{type:l.or,method:(t=e,function(e){var i=[];return t.every((function(t){return!t.method(e).isValid}))&&i.push(t.map((function(e){return e.type})).join(" OR ")),{value:e,isSet:!0,isValid:!i.length,errors:i}})};var t},ENUM:function(e){return{type:l.enum,method:A(e)}}},j=function(){function e(e){this.params={},this.contextErrors=[],this.errors=[],this.isValid=!0,this.setContext(e)}return e.prototype.setContext=function(e){e&&"[object Object]"===Object.prototype.toString.call(e)?this.isValidContext=!0:(this.setCommonError("context is not an object"),this.isValidContext=!1),this.context=e},e.prototype.setValidity=function(){var e=this;this.errors=Object.keys(this.params).reduce((function(t,i){return(0,o.ev)((0,o.ev)([],(0,o.CR)(t),!1),(0,o.CR)(e.params[i].errors),!1)}),[]),this.isValid=!this.errors.length},e.prototype.setCommonError=function(e){this.contextErrors.push(e),this.errors.push(e),this.isValid=!1},e.prototype.setParam=function(e,t){t.isValid||(t.errors=t.isSet?t.errors.map((function(t){return'"'.concat(e,'" ').concat(t)})):['"'.concat(e,'" must be set')]),this.params[e]=t,this.setValidity()},e.prototype.showErrors=function(){return this.errors.length?"validation failed: "+this.errors.join(", "):""},e}(),F=function(e,t,i){var n=e.value,r=e.errors,s=t.method(n,i),a=(0,o.ev)((0,o.ev)([],(0,o.CR)(r),!1),(0,o.CR)(s.errors),!1);return{value:s.value,isSet:s.isSet,isValid:!a.length,errors:a}},B=function(e,t){var i=void 0===e,n=!t.mandatory&&void 0!==t.defaultValue;return{value:i?n?t.defaultValue:void 0:e,isSet:!i||n,isValid:!i||!t.mandatory,errors:[]}},L=function(e,t,i){var n,r,s=B(e[t],i);if(s.isSet)try{for(var a=(0,o.XA)(Object.values(i.validators)),c=a.next();!c.done;c=a.next()){var u=c.value,f=F(s,u,e);if(!f.isValid&&void 0!==i.defaultValue)return{value:i.defaultValue,isSet:!0,isValid:!0,errors:[]};Object.assign(s,f)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}else{var d=i.validators.find((function(e){return e.type===l.oneOfMust}));if(d)return F(s,d,e)}return s},D=function(e,t){var i=new j(e);return Object.entries(t).forEach((function(e){var t=(0,o.CR)(e,2),n=t[0],r=t[1];return i.setParam(n,i.isValidContext?L(i.context,n,r):B(void 0,r))})),i},_=T.OBJECT,U=T.FUNC_WITH_X_AND_MORE_ARGUMENTS;!function(e){e.get="get",e.settings="settings",e.devSettings="devSettings"}(V||(V={}));var W,Z,G,q,X,H=((E={})[V.get]={validators:[U(2)],mandatory:!0},E[V.settings]={validators:[_]},E[V.devSettings]={validators:[_]},E),Y=T.NUMBER,J=T.INTEGER,Q=T.INTEGER_UNLIMITED,K=T.MORE_OR_EQUAL,ee=T.BOOLEAN,te=T.ELEMENT,ie=T.FUNC,ne=T.OR,re=T.ENUM;!function(e){e.adapter="adapter",e.startIndex="startIndex",e.minIndex="minIndex",e.maxIndex="maxIndex",e.itemSize="itemSize",e.bufferSize="bufferSize",e.padding="padding",e.infinite="infinite",e.horizontal="horizontal",e.windowViewport="windowViewport",e.viewportElement="viewportElement",e.inverse="inverse",e.onBeforeClip="onBeforeClip",e.sizeStrategy="sizeStrategy"}(q||(q={})),function(e){e.debug="debug",e.immediateLog="immediateLog",e.logProcessRun="logProcessRun",e.logTime="logTime",e.throttle="throttle",e.initDelay="initDelay",e.initWindowDelay="initWindowDelay",e.cacheData="cacheData",e.cacheOnReload="cacheOnReload",e.dismissOverflowAnchor="dismissOverflowAnchor",e.directionPriority="directionPriority"}(X||(X={}));var oe,se,ae,ce,le,ue,fe,de,he,pe,ge,me,ve,xe,ye,be=((W={})[q.itemSize]=1,W[q.bufferSize]=1,W[q.padding]=.01,W[X.throttle]=0,W[X.initDelay]=0,W[X.initWindowDelay]=0,W),we=((Z={})[q.adapter]={validators:[ee],defaultValue:!1},Z[q.startIndex]={validators:[J],defaultValue:1},Z[q.minIndex]={validators:[Q],defaultValue:-1/0},Z[q.maxIndex]={validators:[Q],defaultValue:1/0},Z[q.itemSize]={validators:[J,K(be[q.itemSize],!0)],defaultValue:NaN},Z[q.bufferSize]={validators:[J,K(be[q.bufferSize],!0)],defaultValue:5},Z[q.padding]={validators:[Y,K(be[q.padding],!0)],defaultValue:.5},Z[q.infinite]={validators:[ee],defaultValue:!1},Z[q.horizontal]={validators:[ee],defaultValue:!1},Z[q.windowViewport]={validators:[ee],defaultValue:!1},Z[q.viewportElement]={validators:[ne([te,ie])],defaultValue:null},Z[q.inverse]={validators:[ee],defaultValue:!1},Z[q.onBeforeClip]={validators:[ie],defaultValue:null},Z[q.sizeStrategy]={validators:[re(c)],defaultValue:c.Average},Z),Ie=((G={})[X.debug]={validators:[ee],defaultValue:!1},G[X.immediateLog]={validators:[ee],defaultValue:!0},G[X.logProcessRun]={validators:[ee],defaultValue:!1},G[X.logTime]={validators:[ee],defaultValue:!1},G[X.throttle]={validators:[J,K(be[X.throttle],!0)],defaultValue:40},G[X.initDelay]={validators:[J,K(be[X.initDelay],!0)],defaultValue:1},G[X.initWindowDelay]={validators:[J,K(be[X.initWindowDelay],!0)],defaultValue:40},G[X.cacheData]={validators:[ee],defaultValue:!1},G[X.cacheOnReload]={validators:[ee],defaultValue:!1},G[X.dismissOverflowAnchor]={validators:[ee],defaultValue:!0},G[X.directionPriority]={validators:[re(a)],defaultValue:a.backward},G);!function(e){e.init="init",e.scroll="scroll",e.start="start",e.preFetch="preFetch",e.fetch="fetch",e.postFetch="postFetch",e.render="render",e.preClip="preClip",e.clip="clip",e.adjust="adjust",e.end="end"}(oe||(oe={})),function(e){e.reset="adapter.reset",e.reload="adapter.reload",e.append="adapter.append",e.prepend="adapter.prepend",e.check="adapter.check",e.remove="adapter.remove",e.replace="adapter.replace",e.update="adapter.update",e.clip="adapter.clip",e.insert="adapter.insert",e.fix="adapter.fix"}(se||(se={})),function(e){e.start="start",e.next="next",e.done="done",e.error="error"}(ae||(ae={}));var Se,ze=T.INTEGER,ke=T.INTEGER_UNLIMITED,Ee=T.BOOLEAN,Ve=T.OBJECT,Me=T.ITEM_LIST,Ne=T.FUNC_WITH_X_ARGUMENTS,Oe=T.FUNC_WITH_X_AND_MORE_ARGUMENTS,Pe=T.FUNC_WITH_X_TO_Y_ARGUMENTS,Re=T.ONE_OF_MUST,$e=T.ONE_OF_CAN,Ce=T.OR;Se||(Se={});var Ae,Te=((ce={})[V.get]={validators:[Oe(2)]},ce[V.settings]={validators:[Ve]},ce[V.devSettings]={validators:[Ve]},ce);!function(e){e.reloadIndex="reloadIndex"}(Ae||(Ae={}));var je,Fe=((le={})[Ae.reloadIndex]={validators:[ze]},le);!function(e){e.items="items",e.bof="bof",e.increase="increase"}(je||(je={}));var Be,Le=((ue={})[je.items]={validators:[Me],mandatory:!0},ue[je.bof]={validators:[Ee],defaultValue:!1},ue[je.increase]={validators:[Ee],defaultValue:!1},ue);!function(e){e.items="items",e.eof="eof",e.decrease="decrease"}(Be||(Be={}));var De,_e=((fe={})[Be.items]={validators:[Me],mandatory:!0},fe[Be.eof]={validators:[Ee],defaultValue:!1},fe[Be.decrease]={validators:[Ee],defaultValue:!1},fe);!function(e){e.predicate="predicate",e.indexes="indexes",e.increase="increase"}(De||(De={}));var Ue,We=((de={})[De.predicate]={validators:[Ne(1),Re([De.indexes])]},de[De.indexes]={validators:[Me,Re([De.predicate])]},de[De.increase]={validators:[Ee],defaultValue:!1},de);!function(e){e.backwardOnly="backwardOnly",e.forwardOnly="forwardOnly"}(Ue||(Ue={}));var Ze,Ge=((he={})[Ue.backwardOnly]={validators:[Ee,$e([Ue.forwardOnly])],defaultValue:!1},he[Ue.forwardOnly]={validators:[Ee,$e([Ue.backwardOnly])],defaultValue:!1},he);!function(e){e.items="items",e.before="before",e.after="after",e.beforeIndex="beforeIndex",e.afterIndex="afterIndex",e.decrease="decrease"}(Ze||(Ze={}));var qe,Xe=((pe={})[Ze.items]={validators:[Me],mandatory:!0},pe[Ze.before]={validators:[Ne(1),Re([Ze.after,Ze.beforeIndex,Ze.afterIndex])]},pe[Ze.after]={validators:[Ne(1),Re([Ze.before,Ze.beforeIndex,Ze.afterIndex])]},pe[Ze.beforeIndex]={validators:[ze,Re([Ze.before,Ze.after,Ze.afterIndex])]},pe[Ze.afterIndex]={validators:[ze,Re([Ze.before,Ze.after,Ze.beforeIndex])]},pe[Ze.decrease]={validators:[Ee],defaultValue:!1},pe);!function(e){e.items="items",e.predicate="predicate",e.fixRight="fixRight"}(qe||(qe={}));var He,Ye=((ge={})[Ze.items]={validators:[Me],mandatory:!0},ge[qe.predicate]={validators:[Ne(1)],mandatory:!0},ge[qe.fixRight]={validators:[Ee],defaultValue:!1},ge);!function(e){e.predicate="predicate",e.fixRight="fixRight"}(He||(He={}));var Je,Qe=((me={})[He.predicate]={validators:[Ne(1)],mandatory:!0},me[He.fixRight]={validators:[Ee],defaultValue:!1},me);!function(e){e.scrollPosition="scrollPosition",e.minIndex="minIndex",e.maxIndex="maxIndex",e.updater="updater",e.scrollToItem="scrollToItem",e.scrollToItemOpt="scrollToItemOpt"}(Je||(Je={}));var Ke=((ve={})[Je.scrollPosition]={validators:[ke]},ve[Je.minIndex]={validators:[ke]},ve[Je.maxIndex]={validators:[ke]},ve[Je.updater]={validators:[Pe(1,2)]},ve[Je.scrollToItem]={validators:[Ne(1)]},ve[Je.scrollToItemOpt]={validators:[Ce([Ee,Ve])]},ve),et=((xe={})[se.reset]=V,xe[se.reload]=Ae,xe[se.prepend]=je,xe[se.append]=Be,xe[se.check]=Se,xe[se.remove]=De,xe[se.clip]=Ue,xe[se.insert]=Ze,xe[se.replace]=qe,xe[se.update]=He,xe[se.fix]=Je,xe),tt=((ye={})[se.reset]=Te,ye[se.reload]=Fe,ye[se.prepend]=Le,ye[se.append]=_e,ye[se.check]={},ye[se.remove]=We,ye[se.clip]=Ge,ye[se.insert]=Xe,ye[se.replace]=Ye,ye[se.update]=Qe,ye[se.fix]=Ke,ye),it=function(){function e(e,t,i){this.parseInput(e,we),this.parseInput(t,Ie),this.instanceIndex=i,this.initializeDelay=this.getInitializeDelay(),this.viewport=this.getViewport()}return e.prototype.parseInput=function(e,t){var i=this,n=D(e,t);if(!n.isValid)throw new Error("Invalid settings");Object.entries(n.params).forEach((function(e){var t,n=(0,o.CR)(e,2),r=n[0],s=n[1];return Object.assign(i,((t={})[r]=s.value,t))}))},e.prototype.getInitializeDelay=function(){var e=0;return this.windowViewport&&this.initWindowDelay&&!("scrollRestoration"in history)&&(e=this.initWindowDelay),this.initDelay>0&&(e=Math.max(e,this.initDelay)),e},e.prototype.getViewport=function(){if("function"!=typeof this.viewportElement)return this.viewportElement;var e=this.viewportElement(),t=L({value:e},"value",{validators:[T.ELEMENT]});return t.isValid?t.value:null},e}(),nt=function(e){var t;return(t=function(){}).process=e,t},rt=function(e){var t;return t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return(0,o.ZT)(i,t),i.parseInput=function(t,i,n,r){void 0===n&&(n=!1);var s={data:D(i,tt[r||e])};return s.data.isValid?s.params=Object.entries(s.data.params).reduce((function(e,t){var i,n=(0,o.CR)(t,2),r=n[0],s=n[1].value;return(0,o.pi)((0,o.pi)({},e),((i={})[r]=s,i))}),{}):(t.logger.log((function(){return s.data.showErrors()})),n||t.workflow.call({process:e,status:ae.error,payload:{error:'Wrong argument of the "'.concat(e,'" method call')}})),s},i}(nt(e)),t.process=e,t},ot=[oe.init,se.reset,se.reload],st=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=e.state,r=e.workflow,o=ot.includes(i);e.logger.logCycle(!0),n.startWorkflowCycle(o,i),r.call({process:t.process,status:ae.next})},t}(nt(oe.init)),at=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=e.workflow,r=e.viewport.scrollPosition;t.onSynthetic(e,r)||t.onThrottle(e,r,(function(){return t.onScroll(e,n)}))},t.onSynthetic=function(e,t){var i=e.state.scroll,n=i.syntheticPosition;if(null!==n){if(i.syntheticFulfill&&(i.syntheticPosition=null),!i.syntheticFulfill||n===t)return e.logger.log((function(){return["skipping scroll",t,"[".concat(i.syntheticFulfill?"":"pre-","synthetic]")]})),!0;e.logger.log((function(){return["synthetic scroll has been fulfilled:",t,t<n?"<":">",n]}))}return!1},t.onThrottle=function(e,i,n){var r=e.state.scroll,o=e.settings.throttle,s=e.logger;r.current=t.getScrollEvent(i,r.previous);var c=r.current,l=c.direction,u=c.time,f=r.previous?u-r.previous.time:1/0,d=o-f,h=isFinite(d)&&d>0,p=!!r.scrollTimer;if(s.log((function(){return[l===a.backward?"⤴":"⤵",i,h?f+"ms":"0ms",h?p?"delayed":"/ ".concat(d,"ms delay"):""]})),!h)return r.scrollTimer&&(clearTimeout(r.scrollTimer),r.scrollTimer=null),void n();p||(r.scrollTimer=setTimeout((function(){s.log((function(){var n=t.getScrollEvent(e.viewport.scrollPosition,r.current);return[n.direction===a.backward?"⤴":"⤵",n.position,n.time-u+"ms","triggered by timer set on",i]})),r.scrollTimer=null,n()}),d))},t.getScrollEvent=function(e,t){var i=Number(new Date),n=a.forward;return t&&(e===t.position?n=t.direction:e<t.position&&(n=a.backward)),{position:e,direction:n,time:i}},t.onScroll=function(e,i){var n=e.state,r=n.scroll,s=n.cycle;r.previous=(0,o.pi)({},r.current),r.current=null,s.busy.get()?e.logger.log((function(){return["skipping scroll",r.previous.position,"[pending]"]})):i.call({process:t.process,status:ae.next})},t}(nt(oe.scroll)),ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=e.datasource,r=e.buffer,o=e.viewport.paddings,s=e.state.cycle;if(i){var a=t.parseInput(e,i).data;if(!a.isValid)return;var c=i instanceof k;Object.keys(V).forEach((function(e){var t=a.params[e],i=n;(t.isSet||c&&i[e])&&(i[e]=t.value)}))}r.reset(!0),o.backward.reset(),o.forward.reset();var l={datasource:n};s.busy.get()&&(l.finalize=!0,s.interrupter=t.process),e.workflow.call({process:t.process,status:ae.next,payload:l})},t}(rt(se.reset)),lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=e.viewport,r=e.state,o=e.buffer,s=t.parseInput(e,{reloadIndex:i},!0).params;o.reset(!1,s?s.reloadIndex:void 0),n.reset(o.startIndex);var a={};r.cycle.busy.get()&&(r.scroll.stop(),a.finalize=!0,r.cycle.interrupter=t.process),e.workflow.call({process:t.process,status:ae.next,payload:a})},t}(rt(se.reload)),ut=function(){function e(e,t,i){this.container={$index:e,data:t},this.nodeId=String(e),this.routines=i,this.invisible=!0,this.toRemove=!1,this.toInsert=!1}return Object.defineProperty(e.prototype,"$index",{get:function(){return this.container.$index},set:function(e){this.container.$index=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.container.data},set:function(e){this.container.data=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.container.element},set:function(e){this.container.element=e},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){delete this.container.element},e.prototype.setSize=function(e){void 0===e&&(e=0),this.preSize=e,this.element&&(this.size=this.routines.getSize(this.element))},e.prototype.makeVisible=function(){this.routines.makeElementVisible(this.element),this.invisible=!1},e.prototype.hide=function(){this.element&&this.routines.hideElement(this.element)},e.prototype.scrollTo=function(e){this.element&&this.routines.scrollTo(this.element,e)},e.prototype.updateIndex=function(e){this.$index=e,this.nodeId=String(e)},e.prototype.get=function(){return this.container},e}(),ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=t.parseInput(e,i).params;if(n){var r=t.doUpdate(e,n);e.workflow.call({process:t.process,status:r?ae.next:ae.done})}},t.doUpdate=function(e,t){var i=e.buffer,n=e.viewport,r=e.state.fetch,o=e.routines,s=e.logger;if(!i.items)return s.log((function(){return"no items in Buffer"})),!1;var c=n.getEdgeVisibleItem(i.items,a.backward),l=c.item,u=c.index,f=c.diff,d=i.updateItems(t.predicate,(function(e,t){return new ut(e,t,o)}),u,!!t.fixRight),h=d.trackedIndex,p=d.toRemove,g=0,m=i.get(h);l&&l===m&&(g=-i.getSizeByIndex(h)+f),p.forEach((function(e){return e.hide()})),s.log((function(){return p.length?"items to remove: ["+p.map((function(e){return e.$index})).join(",")+"]":"no items to remove"})),p.length&&i.checkDefaultSize();var v=i.items.filter((function(e){return e.toInsert}));return s.log((function(){return v.length?"items to render: ["+v.map((function(e){return e.$index})).join(",")+"]":"no items to render"})),r.update(h,g,v,p),!!p.length||!!v.length},t}(rt(se.update)),dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=t.parseInput(e,i).params;if(n){var r=t.doInsert(e,n);e.workflow.call({process:t.process,status:r?ae.next:ae.done})}},t.doInsert=function(e,i){return!!(t.insertEmpty(e,i)||t.insertInBuffer(e,i)||t.insertVirtually(e,i))},t.insertEmpty=function(e,t){var i=e.buffer,n=e.routines,r=e.state.fetch;if(i.size)return!1;var o=t.beforeIndex,s=t.afterIndex,a=t.items,c=t.decrease;return!!i.fillEmpty(a,o,s,!!c,(function(e,t){return new ut(e,t,n)}))&&(r.fill(i.items,i.startIndex),!0)},t.insertInBuffer=function(e,t){var i=t.before,n=t.after,r=t.beforeIndex,s=t.afterIndex,a=t.items,c=t.decrease,l=e.buffer.getIndexToInsert(i||n,r,s);if(isNaN(l))return!1;var u=Number.isInteger(r)||i,f={predicate:function(e){var t=e.$index,i=e.data;return l!==t||(u?(0,o.ev)((0,o.ev)([],(0,o.CR)(a),!1),[i],!1):(0,o.ev)([i],(0,o.CR)(a),!1))},fixRight:c};return ft.doUpdate(e,f)},t.insertVirtually=function(e,t){var i=t.beforeIndex,n=t.afterIndex,r=t.items,o=t.decrease,s=e.buffer,c=e.state.fetch,l=e.viewport,u=Number.isInteger(i)?a.backward:a.forward,f=u===a.backward?i:n;if(!s.insertVirtually(r,f,u,!!o))return!1;var d=l.getEdgeVisibleItem(s.items,a.backward),h=d.index,p=d.diff;return c.firstVisible.index=h,isNaN(h)||(c.simulate=!0,c.firstVisible.delta=-s.getSizeByIndex(h)+p),!0},t}(rt(se.insert)),ht=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=i.process,r=i.options,o=t.parseInput(e,r,!1,n).params;if(o){var s=t.doAppend(e,n,o);e.workflow.call({process:t.process,status:s?ae.next:ae.done})}},t.doAppend=function(e,t,i){var n,r,s=i.bof,a=i.eof,c=i.increase,l=i.decrease,u=e.buffer,f=t===se.prepend,d=f?!c:l,h=i.items;return f?(n=(s?u.absMinIndex:u.minIndex)+(u.size?0:1),h=(0,o.ev)([],(0,o.CR)(h),!1).reverse()):r=(a?u.absMaxIndex:u.maxIndex)-(u.size||d?0:1),dt.doInsert(e,{items:h,beforeIndex:n,afterIndex:r,decrease:d})},t}(rt(se.append)),pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow,n=e.buffer,r=e.state.fetch,o=e.viewport,s=1/0,c=-1/0;if(n.items.forEach((function(e){var t=e.size;e.setSize(),e.size!==t&&(n.cacheItem(e),s=Math.min(s,e.$index),c=Math.max(c,e.$index))})),Number.isFinite(s)){r.first.indexBuffer=n.firstIndex,r.last.indexBuffer=n.lastIndex;var l=o.getEdgeVisibleItem(n.items,a.backward),u=l.index,f=l.diff;r.firstVisible.index=u,isNaN(u)||(r.firstVisible.delta=-n.getSizeByIndex(u)+f),r.check(n.items.filter((function(e){return e.$index>=s&&e.$index<=c})))}e.logger.stat("check"),i.call({process:t.process,status:Number.isFinite(s)?ae.next:ae.done})},t}(rt(se.check)),gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=t.parseInput(e,i).params;if(n){var r=t.doRemove(e,n);e.workflow.call({process:t.process,status:r?ae.next:ae.done})}},t.doRemove=function(e,i){e.state.fetch.firstVisible.index=NaN;var n=t.removeBufferedItems(e,i),r=n.length>0;if(r&&(i.indexes&&i.indexes.length&&(i.indexes=i.indexes.filter((function(e){return!n.includes(e)}))),i.indexes&&i.indexes.length)){var o=(i.increase?1:0)*n.length,s=(i.increase?0:-1)*n.length;i.indexes=i.indexes.map((function(e){return e+(e<n[0]?o:s)}))}var a=t.removeVirtualItems(e,i);return!(!r&&!a)&&(e.logger.stat("after remove"),!0)},t.removeBufferedItems=function(e,t){var i=t.predicate,n=t.indexes,r=t.increase;if(!i&&!n)return[];var s=function(e){return i&&i(e)||!!n&&n.includes(e.$index)},a=e.buffer.items.reduce((function(e,t){return s(t)?(0,o.ev)((0,o.ev)([],(0,o.CR)(e),!1),[t.$index],!1):e}),[]),c={predicate:function(e){return!s(e)},fixRight:r};return ft.doUpdate(e,c),a},t.removeVirtualItems=function(e,i){var n=i.indexes,r=i.increase;if(!n||!n.length)return!1;for(var o=e.buffer,s=e.viewport,c=e.state.fetch,l=o.finiteAbsMinIndex,u=o.firstIndex,f=o.finiteAbsMaxIndex,d=o.lastIndex,h=[],p=0,g=n.length;p<g;p++){if((v=n[p])>=l&&!isNaN(u)&&v<u)h.push(v);else{if(!(v<=f&&!isNaN(d)&&v>d))continue;h.push(v)}}if(!h.length)return!1;if(isNaN(c.firstVisible.index)){var m=s.getEdgeVisibleItem(o.items,a.backward),v=m.index,x=m.diff;c.firstVisible.index=v,isNaN(v)||(c.firstVisible.delta=-o.getSizeByIndex(v)+x)}return e.logger.log((function(){return"going to remove ".concat(h.length," item(s) virtually")})),o.removeVirtually(h,!!r),o.checkDefaultSize(),t.shiftFirstVisibleIndex(e,h,!!r),!0},t.shiftFirstVisibleIndex=function(e,t,i){var n=e.state.fetch.firstVisible;if(!isNaN(n.index)){var r=t.reduce((function(e,t){return e+(i&&t>n.index||!i&&t<n.index?1:0)}),0);n.index=n.index+(i?r:-r)}},t}(rt(se.remove)),mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=t.parseInput(e,i).params;e.state.clip.forceForward=!(n&&n.backwardOnly),e.state.clip.forceBackward=!(n&&n.forwardOnly),e.workflow.call({process:t.process,status:ae.next})},t}(rt(se.clip)),vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=t.parseInput(e,i).params;if(n){var r=t.doReplace(e,n);e.workflow.call({process:t.process,status:r?ae.next:ae.done})}},t.doReplace=function(e,t){var i=e.buffer.items.filter((function(e){return t.predicate(e)})).map((function(e){return e.$index}));if(!i.length)return e.logger.log("no items to be replaced"),!1;var n=!1,r={predicate:function(e){var r=e.$index;return!i.includes(r)||!n&&(n=!0,t.items)},fixRight:t.fixRight};return ft.doUpdate(e,r)},t}(rt(se.replace)),xt=et[se.fix],yt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=e.workflow,r=t.parseInput(e,i),s=r.data;r.params&&(Object.entries(s.params).forEach((function(i){var n=(0,o.CR)(i,2),r=n[0],a=n[1];a.isSet&&a.isValid&&t.runByType(e,r,a.value,s)})),n.call({process:t.process,status:ae.done}))},t.runByType=function(e,i,n,r){switch(i){case xt.scrollPosition:return t.setScrollPosition(e,n);case xt.minIndex:return t.setMinIndex(e,n);case xt.maxIndex:return t.setMaxIndex(e,n);case xt.updater:return t.updateItems(e,n);case xt.scrollToItem:if(r.params){var o=r.params[xt.scrollToItemOpt],s=o?o.value:void 0;return t.scrollToItem(e,n,s)}return;case xt.scrollToItemOpt:return}},t.setScrollPosition=function(e,t){var i=e.viewport,n=t;t===-1/0?n=0:t===1/0&&(n=i.getScrollableSize()),i.setPosition(n)},t.setMinIndex=function(e,t){var i=e.buffer;e.settings.minIndex=t,i.absMinIndex=t},t.setMaxIndex=function(e,t){var i=e.buffer;e.settings.maxIndex=t,i.absMaxIndex=t},t.updateItems=function(e,t){var i=e.buffer,n=e.logger,r=!1,s=function(){return r=!0};i.items.forEach((function(e){return t(e.get(),s)})),r&&(n.log((function(){return"update Buffer.items reference"})),i.items=(0,o.ev)([],(0,o.CR)(i.items),!1))},t.scrollToItem=function(e,t,i){var n=e.buffer.items.find((function(e){return t(e.get())}));n?n.scrollTo(i):e.logger.log((function(){return"scrollToItem cancelled, item not found"}))},t}(rt(se.fix)),bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.state.startInnerLoop();e.workflow.call({process:t.process,status:ae.next,payload:i})},t}(nt(oe.start)),wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow,n=e.buffer,r=e.state,o=r.fetch,s=r.cycle;o.minIndex=n.minIndex,t.setPositionsAndIndexes(e),t.skipBufferedItems(e),e.settings.infinite&&t.checkBufferGaps(e),t.checkFetchPackSize(e),t.setFetchDirection(e),i.call({process:t.process,status:t.getStatus(e),payload:{process:s.initiator}})},t.setPositionsAndIndexes=function(e){t.setPositions(e),t.setFirstIndex(e),t.setLastIndex(e),e.logger.fetch()},t.setPositions=function(e){var i=e.state.fetch.positions,n=e.viewport,r=n.getBufferPadding();i.before=n.scrollPosition,i.startDelta=t.getStartDelta(e),i.relative=i.before-i.startDelta,i.start=i.relative-r,i.end=i.relative+n.getSize()+r},t.getStartDelta=function(e){var t=e.buffer,i=e.viewport.offset,n=0;if(i&&(n+=i),!t.defaultSize)return n;for(var r=t.finiteAbsMinIndex;r<t.startIndex;r++)n+=t.getSizeByIndex(r);return e.logger.log((function(){return(0,o.ev)(["start delta is ".concat(n)],(0,o.CR)(i?[" (+".concat(i," offset)")]:[]),!1)})),n},t.setFirstIndex=function(e){var t=e.state,i=e.buffer,n=t.fetch,r=n.positions.start,o=n.first,s=i.startIndex,a=0;if(t.cycle.innerLoop.isInitial)e.logger.log("skipping fetch backward direction [initial loop]");else if(i.defaultSize)for(var c=a,l=s;;){if(r>=0){var u=i.getSizeByIndex(l);if(c+u-r>0){s=l,a=c;break}if(c+=u,++l<i.absMinIndex)break}if(r<0){if(--l<i.absMinIndex)break;if(s=l,a=c-=i.getSizeByIndex(l),c-r<=0)break}}else e.logger.log("skipping fetch backward direction [no item size]");o.index=o.indexBuffer=Math.max(s,i.absMinIndex),o.position=a},t.setLastIndex=function(e){var t,i=e.state,n=i.fetch,r=i.cycle,o=e.buffer,s=e.settings,a=n.firstVisible,c=n.positions,l=c.relative,u=c.end,f=n.first,d=n.last;if(o.defaultSize){var h=f.indexBuffer,p=f.position;for(t=h;;){t=h;var g=o.getSizeByIndex(h);if(p+=g,isNaN(a.index)&&p>l&&(a.index=h,r.innerLoop.isInitial||(a.delta=p-g-l)),p>=u)break;if(h++>o.absMaxIndex)break}}else t=o.startIndex+s.bufferSize-1,e.logger.log("forcing fetch forward direction [no item size]");d.index=d.indexBuffer=Math.min(t,o.absMaxIndex)},t.skipBufferedItems=function(e){var t=e.buffer;if(t.size){for(var i=e.state.fetch,n=i.first.index,r=i.last.index,o=[[]],s=0,a=n;a<=r;a++)t.get(a)?o[s].length&&(o[++s]=[]):o[s].push(a);var c=o[0];o[0].length&&o[1]&&o[1].length&&(i.hasAnotherPack=!0,o[1].length>=o[0].length&&(c=o[1])),i.first.index=Math.max(c[0],t.absMinIndex),i.last.index=Math.min(c[c.length-1],t.absMaxIndex),i.first.index===n&&i.last.index===r||e.logger.fetch("after Buffer flushing")}},t.checkBufferGaps=function(e){var t=e.buffer,i=e.state.fetch;if(t.size){var n=i.first.index,r=t.lastIndex;n>r&&(i.first.index=i.first.indexBuffer=r+1);var o=t.firstIndex,s=i.last.index;s<o&&(i.last.index=i.last.indexBuffer=o-1),i.first.index===n&&i.last.index===s||e.logger.fetch("after Buffer filling (no clip case)")}},t.checkFetchPackSize=function(e){var i=e.buffer,n=e.state.fetch;if(n.shouldFetch){var r=n.first.index,o=n.last.index,s=e.settings.bufferSize-(o-r+1);if(!(s<=0)){if(!i.size||o>i.items[0].$index){var a=Math.min(o+s,i.absMaxIndex);a>o&&(n.last.index=n.last.indexBuffer=a)}else{var c=Math.max(r-s,i.absMinIndex);c<r&&(n.first.index=n.first.indexBuffer=c)}n.first.index===r&&n.last.index===o||(e.logger.fetch("after bufferSize adjustment"),t.skipBufferedItems(e))}}},t.setFetchDirection=function(e){var t=e.buffer,i=e.state.fetch;if(i.last.index){var n=a.forward;t.size&&(n=i.last.index<t.items[0].$index?a.backward:a.forward),i.direction=n,e.logger.log((function(){return'fetch direction is "'.concat(n,'"')}))}},t.getStatus=function(e){var t=e.state,i=t.cycle,n=t.fetch;return i.initiator===se.clip?(e.logger.log((function(){return'going to skip fetch due to "'.concat(se.clip,'" process')})),ae.next):n.shouldFetch?(e.logger.log((function(){return"going to fetch ".concat(n.count," items started from index ").concat(n.index)})),ae.next):ae.done},t}(nt(oe.preFetch)),It=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow,n={success:function(n){e.logger.log((function(){return"resolved ".concat(n.length," items ")+"(index = ".concat(e.state.fetch.index,", count = ").concat(e.state.fetch.count,")")})),e.state.fetch.newItemsData=n,i.call({process:t.process,status:ae.next})},fail:function(e){return i.call({process:t.process,status:ae.error,payload:{error:e}})}},r=t.get(e);t.complete(e,n,r)},t.complete=function(e,t,i){if(Object.prototype.hasOwnProperty.call(i,"data")){var n=i,r=n.data,o=n.error;n.isError?t.fail(o):t.success(r||[])}else{var s=e.state,a=s.scroll,c=s.fetch,l=e.viewport;null===a.positionBeforeAsync&&(a.positionBeforeAsync=l.scrollPosition),c.cancel=function(){t.success=function(){return null},t.fail=function(){return null}},i.then((function(e){return t.success(e)}),(function(e){return t.fail(e)}))}},t.get=function(e){var t,i,n,r,o=e.datasource.get,s=e.state.fetch,a=function(e){n?n(e):t=e||null},c=function(e){r?r(e):i=e||null},l=o(s.index,s.count,a,c);if(l&&"object"==typeof l&&null!==l){if("function"==typeof l.then)return l;if("function"==typeof l.subscribe)var u=l.subscribe(a,c,(function(){u&&"object"==typeof u&&"function"==typeof u.unsubscribe&&u.unsubscribe()}))}return t||i?{data:i?null:t||[],error:i,isError:!!i}:new Promise((function(e,t){n=e,r=t}))},t}(nt(oe.fetch)),St=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow;t.setItems(e)?(t.setBufferLimits(e),i.call({process:t.process,status:e.state.fetch.hasNewItems?ae.next:ae.done})):i.call({process:t.process,status:ae.error,payload:{error:"Can't set buffer items"}})},t.setBufferLimits=function(e){var t=e.buffer,i=e.state,n=i.fetch,r=i.cycle.innerLoop,o=n.items,s=n.first.index,a=n.last.index;if(o.length){var c=o.length-1;s<o[0].$index&&(t.absMinIndex=o[0].$index),a>o[c].$index&&(t.absMaxIndex=o[c].$index)}else(a<t.minIndex||r.isInitial)&&(t.absMinIndex=t.minIndex),(s>t.maxIndex||r.isInitial)&&(t.absMaxIndex=t.maxIndex)},t.setItems=function(e){var t=e.buffer,i=e.state,n=i.fetch,r=i.cycle,o=n.newItemsData;if(!o||!o.length)return!0;var s=n.index;return o.length<n.count&&(r.innerLoop.isInitial?s=t.startIndex:n.first.index<t.minIndex&&(s=t.minIndex-o.length)),n.items=o.map((function(t,i){return new ut(s+i,t,e.routines)})),t.setItems(n.items)},t}(nt(oe.postFetch)),zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow,n=e.state,r=n.cycle,o=n.render,s=n.scroll,a=e.viewport,c=e.routines;e.logger.stat("before new items render"),null===s.positionBeforeAsync&&(s.positionBeforeAsync=a.scrollPosition),o.cancel=c.render((function(){o.cancel=null,t.doRender(e)?i.call({process:t.process,status:o.noSize?ae.done:ae.next,payload:{process:r.initiator}}):i.call({process:t.process,status:ae.error,payload:{error:"Can't associate item with element"}})}))},t.doRender=function(e){var i=e.state,n=i.fetch,r=i.render,o=e.viewport,s=e.buffer,a=e.logger;return r.positionBefore=o.scrollPosition,!(!n.isCheck&&(r.sizeBefore=o.getScrollableSize(),!n.items.every((function(i){return t.processElement(e,i)}))))&&(s.checkDefaultSize(),r.sizeAfter=o.getScrollableSize(),a.stat("after new items render"),a.log((function(){return r.noSize?"viewport size has not been changed":void 0})),!0)},t.processElement=function(e,t){var i=e.viewport,n=e.buffer,r=i.findItemElementById(t.nodeId);return!!r&&(t.element=r,t.makeVisible(),t.setSize(n.getSizeByIndex(t.$index)),n.cacheItem(t),!0)},t}(nt(oe.render)),kt=function(e){return!!e.call.interrupted},Et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e,i){var n=(void 0===i?{}:i).error,r=e.workflow,s=e.state.cycle.interrupter;if(n||s||t.calculateParams(e,r),kt(r))r.call({process:t.process,status:ae.done});else{var a=t.shouldContinueRun(e,n);e.state.endInnerLoop(),r.call({process:t.process,status:a?ae.next:ae.done,payload:(0,o.pi)({},s?{process:s}:{})})}},t.calculateParams=function(e,t){var i,n=e.adapter,r=e.viewport,o=e.buffer.items;n.wanted.firstVisible&&((i=r.getEdgeVisibleItem(o,a.backward).item)&&i.element===n.firstVisible.element||(n.firstVisible=i?i.get():v));n.wanted.lastVisible&&!kt(t)&&((i=r.getEdgeVisibleItem(o,a.forward).item)&&i.element===n.lastVisible.element||(n.lastVisible=i?i.get():v))},t.shouldContinueRun=function(e,t){var i=e.state,n=i.cycle,r=i.fetch,o=i.render;return!!n.interrupter||!t&&(!(!r.simulate||!r.isCheck||o.noSize)||(!(!r.simulate||!r.doRemove)||!(r.simulate||!(r.hasNewItems&&!o.noSize||r.hasAnotherPack))))},t}(nt(oe.end)),Vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow,n=e.viewport,r=e.state.scroll;r.positionBeforeAdjust=n.scrollPosition,t.setPaddings(e),r.positionAfterAdjust=n.scrollPosition;var o=t.calculatePosition(e);t.setAdditionalForwardPadding(e,o),t.setPosition(e,o,(function(){return i.call({process:t.process,status:ae.done})}))},t.setPaddings=function(e){var t,i,n=e.viewport,r=e.buffer,o=e.settings.inverse,s=e.state.fetch,a=r.getFirstVisibleItem(),c=r.getLastVisibleItem();a&&c?(t=a.$index,i=c.$index):i=(t=isNaN(s.firstVisible.index)?r.startIndex:s.firstVisible.index)-1;var l,u=n.paddings,f=u.forward,d=u.backward,h=0,p=0;for(l=r.finiteAbsMinIndex;l<t;l++)h+=r.getSizeByIndex(l);for(l=i+1;l<=r.finiteAbsMaxIndex;l++)p+=r.getSizeByIndex(l);var g=h+(n.getScrollableSize()-f.size-d.size)+p,m=n.getSize()-g;m>0&&(o?h+=m:p+=m,e.logger.log((function(){return o?"backward":"forward"+" padding will be increased by ".concat(m," to fill the viewport")}))),d.size=h,f.size=p,e.logger.stat("after paddings adjustments")},t.calculatePosition=function(e){var t=e.viewport,i=e.buffer,n=e.state,r=n.fetch,o=n.render,s=n.scroll,a=t.paddings.backward.size;if(!isNaN(r.firstVisible.index)&&!isNaN(i.firstIndex)){e.logger.log("first index = ".concat(r.firstVisible.index,", delta = ").concat(r.firstVisible.delta));var c=r.shouldCheckPreSizeExpectation(i.lastIndex);i.items.forEach((function(e){e.$index<r.firstVisible.index?a+=e.size:(e.$index===r.firstVisible.index&&r.firstVisible.delta&&(a-=r.firstVisible.delta),c&&e.preSize&&r.items.includes(e)&&(a+=e.size-e.preSize))}))}if(null!==s.positionBeforeAsync){var l=o.positionBefore-s.positionBeforeAsync;0!==l&&(e.logger.log("shift position due to fetch-render difference (".concat(l,")")),a+=l)}return t.offset>0&&(a||r.positions.before)&&(a+=t.offset),Math.round(a)},t.setAdditionalForwardPadding=function(e,t){var i=e.viewport,n=e.buffer;if(e.state.cycle.isInitial&&Et.shouldContinueRun(e,null)){var r=t-i.getMaxScrollPosition();if(!(r<=0)){var o=n.getLastVisibleItem();if(o){for(var s=0,a=o.$index+1;s<=r&&a<=n.absMaxIndex;)s+=n.getSizeByIndex(a++);var c=Math.min(s,r);c&&(i.paddings.forward.size+=c,e.logger.log("increase fwd padding due to lack of items (".concat(r," -> ").concat(c,")")))}}}},t.setPosition=function(e,t,i){var n=e.state.scroll,r=e.viewport,o=e.routines;if(!n.hasPositionChanged(t))return i();n.syntheticPosition=t,n.syntheticFulfill=!1,n.cancelAnimation=o.animate((function(){n.cancelAnimation=null;var o=n.positionAfterAdjust-r.scrollPosition,s="";o>0&&(t-=o,n.syntheticPosition=t,s=" (-".concat(o,")")),n.syntheticFulfill=!0,r.scrollPosition=t,e.logger.stat("after scroll adjustment"+s),i()}))},t}(nt(oe.adjust)),Mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){t.prepareClip(e),e.workflow.call({process:t.process,status:ae.next,payload:{doClip:e.state.clip.doClip}})},t.prepareClip=function(e){var i=e.state,n=i.fetch,r=i.clip;if(!t.shouldNotClip(e)){var o=n.first.indexBuffer,s=n.last.indexBuffer;e.logger.log((function(){return"looking for ".concat(n.direction?"anti-"+n.direction+" ":"","items ")+"that are out of [".concat(o,"..").concat(s,"] range")})),t.isBackward(e,o)&&t.prepareClipByDirection(e,a.backward,o),t.isForward(e,s)&&t.prepareClipByDirection(e,a.forward,s),r.doClip||e.logger.log("skipping clip [no items to clip]")}},t.shouldNotClip=function(e){var t=e.settings,i=e.buffer,n=e.state;return t.infinite&&!n.clip.force?(e.logger.log("skipping clip [infinite mode]"),!0):i.size?!!n.cycle.isInitial&&(e.logger.log("skipping clip [initial cycle]"),!0):(e.logger.log("skipping clip [empty buffer]"),!0)},t.isBackward=function(e,t){var i=e.buffer,n=e.state,r=n.clip,o=n.fetch;return r.force?r.forceBackward:o.direction!==a.backward&&t-1>=i.absMinIndex},t.isForward=function(e,t){var i=e.buffer,n=e.state,r=n.clip,o=n.fetch;return r.force?r.forceForward:o.direction!==a.forward&&t+1<=i.absMaxIndex},t.prepareClipByDirection=function(e,t,i){var n=t===a.forward;e.buffer.items.forEach((function(r){(!n&&r.$index<i||n&&r.$index>i)&&(r.toRemove=!0,r.removeDirection=t,e.state.clip.doClip=!0)}))},t}(nt(oe.preClip)),Nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.run=function(e){var i=e.workflow;t.doClip(e),i.call({process:t.process,status:ae.next})},t.doClip=function(e){var t,i=e.buffer,n=e.viewport.paddings,r=e.state.clip,o=e.logger,s=((t={})[a.backward]=0,t[a.forward]=0,t);o.stat("before clip (".concat(++r.callCount,")"));var c=i.items.filter((function(e){return!!e.toRemove&&(e.hide(),s[e.removeDirection]+=e.size,!0)}));c.length&&(s[a.backward]&&(n.byDirection(a.backward).size+=s[a.backward]),s[a.forward]&&(n.byDirection(a.forward).size+=s[a.forward]),e.settings.onBeforeClip&&e.settings.onBeforeClip(c.map((function(e){return e.get()})))),i.clip(),o.log((function(){var e=c.map((function(e){return e.$index}));return e.length?["clipped ".concat(e.length," item(s) from Buffer")+(s.backward?", +".concat(s.backward," fwd px"):"")+(s.forward?", +".concat(s.forward," bwd px"):"")+", range: [".concat(e[0],"..").concat(e[e.length-1],"]")]:"clipped 0 items from Buffer"})),o.stat("after clip")},t}(nt(oe.clip)),Ot=function(){function e(e,t,i){var n=this;this.logs=[],this.logAdapterMethod=function(e,t,i){if(n.debug){var r=(void 0===t?[]:Array.isArray(t)?t:[t]).map((function(e){return"function"==typeof e?"func":"object"==typeof e&&e?Array.isArray(e)?"[of ".concat(e.length,"]"):"{ "+Object.keys(e).join(", ")+" }":e})).join(", ");n.log("adapter: ".concat(e,"(").concat(r||"",")").concat(i||""))}};var r=e.settings;this.debug=r.debug,this.immediateLog=r.immediateLog,this.logTime=r.logTime,this.getTime=function(){return e.state&&" // time: ".concat(e.state.time)},this.getStat=function(){var t=e.buffer,i=e.viewport,n=t.getFirstVisibleItem(),r=t.getLastVisibleItem();return"pos: "+i.scrollPosition+", size: "+i.getScrollableSize()+", bwd_p: "+i.paddings.backward.size+", fwd_p: "+i.paddings.forward.size+", default: "+(t.defaultSize||"no")+", items: "+t.getVisibleItemsCount()+", range: "+(n&&r?"[".concat(n.$index,"..").concat(r.$index,"]"):"no")},this.getFetchRange=function(){var t=e.state.fetch,i=t.first.index,n=t.last.index;return Number.isNaN(i)||Number.isNaN(n)?"no":"[".concat(i,"..").concat(n,"]")},this.getLoopId=function(){return e.state.cycle.loopId},this.getLoopIdNext=function(){return e.state.cycle.loopIdNext},this.getWorkflowCycleData=function(){return"".concat(r.instanceIndex,"-").concat(e.state.cycle.count)},this.getScrollPosition=function(){return e.routines.getScrollPosition()},this.log((function(){return"vscroll Workflow has been started, "+"core: ".concat(t.core.name," v").concat(t.core.version,", ")+"consumer: ".concat(t.consumer.name," v").concat(t.consumer.version,", ")+"scroller instance: ".concat(r.instanceIndex,", adapter ")+(i?"instance: ".concat(i.id):"is not instantiated")}))}return e.prototype.object=function(e,t,i){this.log((function(){return[e,i?JSON.stringify(t,(function(e,t){return Number.isNaN(t)?"NaN":t===1/0?"Infinity":t===-1/0?"-Infinity":t instanceof Element?"HTMLElement":t instanceof HTMLDocument?"HTMLDocument":"function"==typeof t?"Function":t})).replace(/"/g,"").replace(/(\{|:|,)/g,"$1 ").replace(/(\})/g," $1"):t]}))},e.prototype.stat=function(e){var t=this;if(this.debug){var i=["color: #888; border: dashed #888 0; border-bottom-width: 0px","color: #000; border-width: 0"];this.log((function(){return(0,o.ev)(["%cstat"+(e?" ".concat(e):"")+",%c "+t.getStat()],(0,o.CR)(i),!1)}))}},e.prototype.fetch=function(e){var t=this;if(this.debug){var i="fetch interval"+(e?" ".concat(e):""),n=["color: #888","color: #000"];this.log((function(){return(0,o.ev)(["%c".concat(i,": %c").concat(t.getFetchRange())],(0,o.CR)(n),!1)}))}},e.prototype.prepareForLog=function(e){return e instanceof Event&&e.target?this.getScrollPosition():e},e.prototype.logProcess=function(e){if(this.debug){var t=e.process,i=e.status,n=e.payload,r=[];if(t===oe.init&&i===ae.next)r.push("%c---=== loop ".concat(this.getLoopIdNext()," start"));else if(t===oe.end){r.push("%c---=== loop ".concat(this.getLoopId()," done"));var s=n&&n.process;i===ae.next&&s!==se.reset&&s!==se.reload&&(r[0]+=", loop ".concat(this.getLoopIdNext()," start"))}r.length&&this.log((function(){return(0,o.ev)((0,o.ev)([],(0,o.CR)(r),!1),["color: #006600;"],!1)}))}},e.prototype.logCycle=function(e){void 0===e&&(e=!0);var t=this.getWorkflowCycleData(),i="color: #0000aa; border: solid #555 1px; border-width: ".concat(e?"1px 0 0 1px":"0 0 1px 1px","; margin-left: -2px");this.log((function(){return["%c   ~~~ WF Cycle ".concat(t," ").concat(e?"STARTED":"FINALIZED"," ~~~  "),i]}))},e.prototype.logError=function(e){var t=this;if(this.debug){var i=["color: #a00;","color: #000"];this.log((function(){return(0,o.ev)(["error:%c"+(e?" ".concat(e):"")+"%c (loop ".concat(t.getLoopIdNext(),")")],(0,o.CR)(i),!1)}))}},e.prototype.log=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(this.debug){if("function"==typeof t[0]&&(t=t[0](),Array.isArray(t)||(t=[t])),t.every((function(e){return void 0===e})))return;this.logTime&&(t=(0,o.ev)((0,o.ev)([],(0,o.CR)(t),!1),[this.getTime()],!1)),t=t.map((function(t){return e.prepareForLog(t)})),this.immediateLog?console.log.apply(this,t):this.logs.push(t)}},e.prototype.logForce=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.debug&&(!this.immediateLog&&this.logs.length&&(this.logs.forEach((function(t){return console.log.apply(e,t)})),this.logs=[]),t.length&&console.log.apply(this,t))},e}(),Pt=function(){function e(e,t,i){var n=this;if(this.element=e,this.settings={viewport:t.viewport,horizontal:t.horizontal,window:t.windowViewport},i){var r=new i(e,this.settings);Object.getOwnPropertyNames(Object.getPrototypeOf(r)).filter((function(e){return"constructor"!==e&&"function"==typeof r[e]&&"function"==typeof n[e]})).forEach((function(e){return n[e]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return r[e].apply(n,t)}}))}this.viewport=this.getViewportElement(),this.onInit(t)}return e.prototype.checkElement=function(e){if(!e)throw new Error("HTML element is not defined")},e.prototype.getViewportElement=function(){if(this.settings.window)return document.documentElement;if(this.settings.viewport)return this.settings.viewport;this.checkElement(this.element);var e=this.element.parentElement;return this.checkElement(e),e},e.prototype.onInit=function(e){e.windowViewport&&"scrollRestoration"in history&&(history.scrollRestoration="manual"),e.dismissOverflowAnchor&&(this.viewport.style.overflowAnchor="none")},e.prototype.findElementBySelector=function(e,t){return this.checkElement(e),e.querySelector(t)},e.prototype.findPaddingElement=function(e){return this.findElementBySelector(this.element,"[data-padding-".concat(e,"]"))},e.prototype.findItemElement=function(e){return this.findElementBySelector(this.element,'[data-sid="'.concat(e,'"]'))},e.prototype.getScrollPosition=function(){return this.settings.window?this.settings.horizontal?window.pageXOffset:window.pageYOffset:this.viewport[this.settings.horizontal?"scrollLeft":"scrollTop"]},e.prototype.setScrollPosition=function(e){e=Math.max(0,e),this.settings.window?this.settings.horizontal?window.scrollTo(e,window.scrollY):window.scrollTo(window.scrollX,e):this.viewport[this.settings.horizontal?"scrollLeft":"scrollTop"]=e},e.prototype.getElementParams=function(e){return this.checkElement(e),e.getBoundingClientRect()},e.prototype.getWindowParams=function(){var e=this.viewport,t=e.clientWidth,i=e.clientHeight,n=e.clientLeft,r=e.clientTop;return{height:i,width:t,top:r,bottom:r+i,left:n,right:n+t,x:n,y:r,toJSON:function(){return null}}},e.prototype.getSize=function(e){return this.getElementParams(e)[this.settings.horizontal?"width":"height"]},e.prototype.getScrollerSize=function(){return this.getElementParams(this.element)[this.settings.horizontal?"width":"height"]},e.prototype.getViewportSize=function(){return this.settings.window?this.getWindowParams()[this.settings.horizontal?"width":"height"]:this.getSize(this.viewport)},e.prototype.getSizeStyle=function(e){this.checkElement(e);var t=e.style[this.settings.horizontal?"width":"height"];return parseFloat(t)||0},e.prototype.setSizeStyle=function(e,t){this.checkElement(e),t=Math.max(0,Math.round(t)),e.style[this.settings.horizontal?"width":"height"]="".concat(t,"px")},e.prototype.getEdge=function(e,t){var i=this.settings.horizontal;return this.getElementParams(e)[t===a.forward?i?"right":"bottom":i?"left":"top"]},e.prototype.getViewportEdge=function(e){var t=this.settings,i=t.window,n=t.horizontal;return i?this.getWindowParams()[e===a.forward?n?"right":"bottom":n?"left":"top"]:this.getEdge(this.viewport,e)},e.prototype.makeElementVisible=function(e){this.checkElement(e),e.style.left="",e.style.top="",e.style.position=""},e.prototype.hideElement=function(e){this.checkElement(e),e.style.display="none"},e.prototype.getOffset=function(){var e=this,t=function(t){return(e.settings.horizontal?t.offsetLeft:t.offsetTop)||0};return t(this.element)-(this.settings.window?0:t(this.viewport))},e.prototype.scrollTo=function(e,t){this.checkElement(e),e.scrollIntoView(t)},e.prototype.render=function(e){var t=setTimeout((function(){return e()}));return function(){return clearTimeout(t)}},e.prototype.animate=function(e){var t=requestAnimationFrame((function(){return e()}));return function(){return cancelAnimationFrame(t)}},e.prototype.onScroll=function(e){var t=this.settings.window?window:this.viewport;return t.addEventListener("scroll",e),function(){return t.removeEventListener("scroll",e)}},e}(),Rt=function(){function e(e,t){var i=t.findPaddingElement(e);t.checkElement(i),this.element=i,this.direction=e,this.routines=t}return e.prototype.reset=function(e){this.size=e||0},Object.defineProperty(e.prototype,"size",{get:function(){return this.routines.getSizeStyle(this.element)},set:function(e){this.routines.setSizeStyle(this.element,e)},enumerable:!1,configurable:!0}),e}(),$t=function(){function e(e,t){this.settings=t,this.forward=new Rt(a.forward,e),this.backward=new Rt(a.backward,e)}return e.prototype.byDirection=function(e,t){return e===a.backward?t?this.forward:this.backward:t?this.backward:this.forward},e.prototype.reset=function(e,t,i){var n,r=this.getPositiveSize(t,e,i),o=this.getNegativeSize(t);this.settings.inverse?(this.forward.reset(o),this.backward.reset(r),(n=e-this.backward.size-i)>0&&(this.backward.size+=n,this.forward.size-=n)):(this.forward.reset(r),this.backward.reset(o),(n=e-this.forward.size-i)>0&&(this.backward.size-=n,this.forward.size+=n))},e.prototype.getPositiveSize=function(e,t,i){var n=this.settings,r=t;return isFinite(n.maxIndex)&&(r=(n.maxIndex-e+1)*n.itemSize),i&&(r=Math.max(r-i,0)),r},e.prototype.getNegativeSize=function(e){var t=this.settings,i=0;return isFinite(t.minIndex)&&(i=(e-t.minIndex)*t.itemSize),i},e}(),Ct=function(){function e(e,t,i,n){this.settings=e,this.routines=t,this.state=i,this.logger=n,this.paddings=new $t(this.routines,e)}return e.prototype.reset=function(e){this.setOffset(),this.paddings.reset(this.getSize(),e,this.offset),this.scrollPosition=this.paddings.backward.size||0,this.state.scroll.reset()},e.prototype.setPosition=function(e){if(this.scrollPosition===e)return this.logger.log((function(){return["setting scroll position at",e,"[cancelled]"]})),e;this.routines.setScrollPosition(e);var t=this.scrollPosition;return this.logger.log((function(){return(0,o.ev)(["setting scroll position at",t],(0,o.CR)(t!==e?["(".concat(e,")")]:[]),!1)})),t},Object.defineProperty(e.prototype,"scrollPosition",{get:function(){return this.routines.getScrollPosition()},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),e.prototype.getSize=function(){return this.routines.getViewportSize()},e.prototype.getScrollableSize=function(){return this.routines.getScrollerSize()},e.prototype.getMaxScrollPosition=function(){return this.getScrollableSize()-this.getSize()},e.prototype.getBufferPadding=function(){return this.getSize()*this.settings.padding},e.prototype.getEdge=function(e){return this.routines.getViewportEdge(e)},e.prototype.setOffset=function(){this.offset=this.routines.getOffset()},e.prototype.findItemElementById=function(e){return this.routines.findItemElement(e)},e.prototype.getEdgeVisibleItem=function(e,t){for(var i,n=t===a.backward,r=n?a.forward:a.backward,o=this.getEdge(t),s=0,c=n?0:e.length-1;n?c<=e.length-1:c>=0;c+=n?1:-1){if(s=this.routines.getEdge(e[c].element,r)-o,n&&s>0||!n&&s<0){i=e[c];break}}return{item:i,index:i?i.$index:NaN,diff:s}},e}(),At=function(){function e(){this.reset()}return e.prototype.reset=function(){this.newItems=[],this.oldItems=[],this.removed=[]},e}(),Tt=function(){function e(e,t){this.itemSize=e,this.sizeStrategy=t,this.sizeMap=new Map,this.recalculation=new At}return e.prototype.reset=function(e){e&&(this.constantSize=this.itemSize,this.frequentSize=this.itemSize,this.averageSize=this.itemSize,this.averageSizeFloat=this.itemSize,this.sizeMap.clear()),this.recalculation.reset()},e.prototype.get=function(){switch(this.sizeStrategy){case c.Average:return this.averageSize;case c.Frequent:return this.frequentSize;default:return this.constantSize}},e.prototype.recalculateAverageSize=function(e){var t=this.recalculation,i=t.oldItems,n=t.newItems,r=t.removed;if(i.length){var o=i.reduce((function(e,t){return e+t.size}),0),s=i.reduce((function(e,t){return e+t.newSize}),0),a=this.averageSizeFloat||0;this.averageSizeFloat=a-(o-s)/(e-n.length)}if(n.length){s=n.reduce((function(e,t){return e+t.size}),0),a=this.averageSizeFloat||0;this.averageSizeFloat=((e-n.length)*a+s)/e}if(r.length){var c=r.reduce((function(e,t){return e+t.size}),0);a=this.averageSizeFloat||0;this.averageSizeFloat=((e+r.length)*a-c)/e}this.averageSize=Math.round(this.averageSizeFloat)},e.prototype.recalculateFrequentSize=function(){var e=this,t=this.recalculation,i=t.oldItems,n=t.newItems,r=t.removed,s=this.sizeMap.get(this.frequentSize);n.length&&n.forEach((function(t){var i=t.size;return e.sizeMap.set(i,(e.sizeMap.get(i)||0)+1)})),i.length&&(i.forEach((function(t){var i=t.size;return e.sizeMap.set(i,Math.max((e.sizeMap.get(i)||0)-1,0))})),i.forEach((function(t){var i=t.newSize;return e.sizeMap.set(i,(e.sizeMap.get(i)||0)+1)}))),r.length&&r.forEach((function(t){var i=t.size;return e.sizeMap.set(i,Math.max((e.sizeMap.get(i)||0)-1,0))}));var a=(0,o.ev)([],(0,o.CR)(this.sizeMap.entries()),!1).sort((function(e,t){return t[1]-e[1]})),c=a[0][1],l=a.filter((function(e){return e[1]===c}));l.length>1&&l.find((function(e){return e[0]===s}))||(this.frequentSize=a[0][0])},e.prototype.recalculate=function(e){if(this.sizeStrategy===c.Constant)return!1;var t=this.recalculation,i=t.oldItems,n=t.newItems,r=t.removed;if(!i.length&&!n.length&&!r.length)return!1;var o=this.get();return e?(this.sizeStrategy===c.Average?this.recalculateAverageSize(e):this.recalculateFrequentSize(),this.recalculation.reset()):this.reset(!0),this.get()!==o},e.prototype.setExisted=function(e,t){this.sizeStrategy!==c.Constant&&this.recalculation.oldItems.push({size:e,newSize:t})},e.prototype.setNew=function(e){this.sizeStrategy!==c.Constant?this.recalculation.newItems.push({size:e}):this.constantSize||(this.constantSize=e)},e.prototype.setRemoved=function(e){this.sizeStrategy!==c.Constant&&this.recalculation.removed.push({size:e})},e}(),jt=function(){function e(e,t){this.$index=e.$index,this.data=t?e.data:null,this.size=e.size}return e.prototype.changeIndex=function(e){this.$index=e},e}(),Ft=function(){function e(e,t){var i=e.itemSize,n=e.cacheData,r=e.cacheOnReload,o=e.sizeStrategy;this.itemSize=i,this.saveData=n,this.cacheOnReload=r,this.sizeStrategy=o,this.logger=t,this.items=new Map,this.defaultSize=new Tt(i,o),this.reset(!0)}return e.prototype.reset=function(e){(e=e||!this.cacheOnReload)&&(this.minIndex=1/0,this.maxIndex=-1/0,this.items.clear()),this.defaultSize.reset(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this.items.size},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.items.get(e)},e.prototype.getSizeByIndex=function(e){var t=this.get(e);return t&&t.size||this.defaultSize.get()},e.prototype.getDefaultSize=function(){return this.defaultSize.get()},e.prototype.recalculateDefaultSize=function(){var e=this;return!!this.defaultSize.recalculate(this.size)&&(this.logger.log((function(){return"default size has been updated: ".concat(e.defaultSize.get())})),!0)},e.prototype.add=function(e){var t=this.get(e.$index);return t?(this.saveData&&(t.data=e.data),t.size!==e.size&&(t.size?this.defaultSize.setExisted(t.size,e.size):this.defaultSize.setNew(e.size),t.size=e.size)):(t=new jt(e,this.saveData),this.items.set(e.$index,t),this.defaultSize.setNew(e.size)),e.$index<this.minIndex&&(this.minIndex=e.$index),e.$index>this.maxIndex&&(this.maxIndex=e.$index),t},e.prototype.insertItems=function(e,t,i,n){var r=this,o=new Map,s=e.length,c=1/0,l=-1/0,u=function(e){o.set(e.$index,e),c=e.$index<c?e.$index:c,l=e.$index>l?e.$index:l};this.items.forEach((function(e){var r=0;i===a.backward?e.$index<t&&n?r=-s:e.$index>=t&&!n&&(r=s):i===a.forward&&(e.$index<=t&&n?r=-s:e.$index>t&&!n&&(r=s)),r&&e.changeIndex(e.$index+r),u(e)})),this.saveData&&e.forEach((function(e,o){var c=t+o-(n?s:0)+(i===a.forward?1:0),l=new jt({$index:c,data:e},r.saveData);u(l)})),this.items=o,this.minIndex=c,this.maxIndex=l},e.prototype.removeItems=function(e,t){var i=this,n=new Map,r=1/0,o=-1/0;this.items.forEach((function(s){if(e.some((function(e){return e===s.$index})))s.size&&i.defaultSize.setRemoved(s.size);else{var a=t?e.reduce((function(e,t){return e+(s.$index<t?1:0)}),0):e.reduce((function(e,t){return e-(s.$index>t?1:0)}),0);s.changeIndex(s.$index+a),n.set(s.$index,s),r=s.$index<r?s.$index:r,o=s.$index>o?s.$index:o}})),this.items=n,this.minIndex=r,this.maxIndex=o},e.prototype.updateSubset=function(e,t,i){var n=this;if(this.size&&e.length){var r,o,s=e[0].$index,a=e[e.length-1].$index;if(t.length){var c=t[0].$index,l=t[t.length-1].$index;r=c-s,o=l-a}else r=i?a-s+1:0,o=i?0:s-a-1;var u=new Map;this.items.forEach((function(e){return e.$index<s?(e.changeIndex(e.$index+r),void u.set(e.$index,e)):e.$index>a?(e.changeIndex(e.$index+o),void u.set(e.$index,e)):void 0})),t.forEach((function(e){return u.set(e.$index,new jt(e,n.saveData))})),e.filter((function(e){return e.toRemove})).forEach((function(e){return n.defaultSize.setRemoved(e.size)})),this.minIndex+=r,this.maxIndex+=o,this.items=u}},e.prototype.shiftIndexes=function(e){var t=new Map,i=1/0,n=-1/0;this.items.forEach((function(r){r.changeIndex(r.$index+e),t.set(r.$index,r),i=r.$index<i?r.$index:i,n=r.$index>n?r.$index:n})),this.items=t,this.minIndex=i,this.maxIndex=n},e}(),Bt=function(){function e(e,t){this.context=e,this.logger=t}return e.prototype.fillEmpty=function(e,t,i){return e.length?Number.isInteger(t)||Number.isInteger(i)?(this.logger.log((function(){return"going to fill the buffer with ".concat(e.length," item(s)")})),!0):(this.logger.log("no items to fill the buffer; wrong indexes"),!1):(this.logger.log("no items to fill the buffer; empty list"),!1)},e.prototype.insertInBuffer=function(e,t,i){var n=Number.isInteger(t)?t:Number.isInteger(i)?i:NaN,r=this.context.items.find((function(t){return e&&e(t.get())||Number.isInteger(n)&&n===t.$index}));return r?r.$index:(this.logger.log("no items to insert in buffer; empty predicate's result"),NaN)},e.prototype.insertVirtual=function(e,t,i){if(!e.length)return this.logger.log("no items to insert virtually; empty list"),!1;var n=this.context,r=n.firstIndex,o=n.lastIndex,s=n.finiteAbsMinIndex,c=n.finiteAbsMaxIndex;if(t<s||t>c)return this.logger.log((function(){return"no items to insert virtually; "+"selected index (".concat(t,") does not match virtual area [").concat(s,"..").concat(c,"]")})),!1;var l=i===a.backward;return t<r+(l?1:0)||t>o-(l?0:1)?(this.logger.log((function(){return"going to insert ".concat(e.length," item(s) virtually")})),!0):(this.logger.log((function(){return"no items to insert virtually; selected index (".concat(t,") belongs Buffer [").concat(r,"..").concat(o,"]")})),!1)},e}(),Lt=function(){function e(e,t,i){this._items=[],this.logger=i,this.changeItems=t,this.bof=new s(!1),this.eof=new s(!1),this.cache=new Ft(e,i),this.checkCall=new Bt(this,i),this.startIndexUser=e.startIndex,this.minIndexUser=e.minIndex,this.maxIndexUser=e.maxIndex,this.reset(!0)}return e.prototype.dispose=function(){this.bof.dispose(),this.eof.dispose(),this._items.forEach((function(e){return e.dispose()})),this._items=[]},e.prototype.reset=function(e,t){this.items.forEach((function(e){return e.hide()})),this.pristine=!0,this.items=[],this.cache.reset(e),this.absMinIndex=this.minIndexUser,this.absMaxIndex=this.maxIndexUser,this.setCurrentStartIndex(t),this.bof.set(!1),this.eof.set(!1),this.pristine=!1},e.prototype.setCurrentStartIndex=function(e){var t=this.minIndexUser,i=this.maxIndexUser,n=this.startIndexUser,r=Number(e);Number.isNaN(r)&&(this.logger.log((function(){return"fallback startIndex to settings.startIndex (".concat(n,")")})),r=n),r<t&&(this.logger.log((function(){return"setting startIndex to settings.minIndex (".concat(t,") because ").concat(r," < ").concat(t)})),r=t),r>i&&(this.logger.log((function(){return"setting startIndex to settings.maxIndex (".concat(i,") because ").concat(r," > ").concat(i)})),r=i),this.startIndex=r},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e,this.changeItems(e),this.pristine||(this.checkBOF(),this.checkEOF())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absMinIndex",{get:function(){return this._absMinIndex},set:function(e){this._absMinIndex!==e&&(this._absMinIndex=Number.isFinite(this._absMaxIndex)&&e>this._absMaxIndex?this._absMaxIndex:e),this.pristine||this.checkBOF()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absMaxIndex",{get:function(){return this._absMaxIndex},set:function(e){this._absMaxIndex!==e&&(this._absMaxIndex=Number.isFinite(this._absMinIndex)&&e<this._absMinIndex?this._absMinIndex:e),this.pristine||this.checkEOF()},enumerable:!1,configurable:!0}),e.prototype.checkBOF=function(){var e=this.items.length?this.items[0].$index===this.absMinIndex:isFinite(this.absMinIndex);this.bof.set(e)},e.prototype.checkEOF=function(){var e=this.items.length?this.items[this.items.length-1].$index===this.absMaxIndex:isFinite(this.absMaxIndex);this.eof.set(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cacheSize",{get:function(){return this.cache.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultSize",{get:function(){return this.cache.getDefaultSize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minIndex",{get:function(){return isFinite(this.cache.minIndex)?this.cache.minIndex:this.startIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxIndex",{get:function(){return isFinite(this.cache.maxIndex)?this.cache.maxIndex:this.startIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstIndex",{get:function(){return this.items.length?this.items[0].$index:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this.items.length?this.items[this.items.length-1].$index:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"finiteAbsMinIndex",{get:function(){return isFinite(this.absMinIndex)?this.absMinIndex:this.minIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"finiteAbsMaxIndex",{get:function(){return isFinite(this.absMaxIndex)?this.absMaxIndex:this.maxIndex},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.items.find((function(t){return t.$index===e}))},e.prototype.setItems=function(e){if(this.items.length)if(this.items[0].$index>e[e.length-1].$index)this.items=(0,o.ev)((0,o.ev)([],(0,o.CR)(e),!1),(0,o.CR)(this.items),!1);else{if(!(e[0].$index>this.items[this.items.length-1].$index))return!1;this.items=(0,o.ev)((0,o.ev)([],(0,o.CR)(this.items),!1),(0,o.CR)(e),!1)}else this.items=(0,o.ev)([],(0,o.CR)(e),!1);return!0},e.prototype.clip=function(){this.items=this.items.filter((function(e){return!e.toRemove}))},e.prototype.getIndexToInsert=function(e,t,i){return this.checkCall.insertInBuffer(e,t,i)},e.prototype.shiftExtremum=function(e,t){t?(this.absMinIndex-=e,this.startIndex-=e):this.absMaxIndex+=e,this.startIndex>this.absMaxIndex?this.startIndex=this.absMaxIndex:this.startIndex<this.absMinIndex&&(this.startIndex=this.absMinIndex)},e.prototype.insertVirtually=function(e,t,i,n){if(!this.checkCall.insertVirtual(e,t,i))return!1;var r=0;return t<=this.firstIndex&&!n?r=e.length:t>=this.lastIndex&&n&&(r=-e.length),r&&(this.items.forEach((function(e){return e.updateIndex(e.$index+r)})),this.cache.insertItems(e,t,i,n),this.items=(0,o.ev)([],(0,o.CR)(this.items),!1)),this.shiftExtremum(e.length,n),!0},e.prototype.removeVirtually=function(e,t){for(var i=this.items.length,n=!1,r=function(i){var r=s.items[i],o=e.reduce((function(e,i){return e+(t?r.$index<i?1:0:r.$index>i?-1:0)}),0);n=n||!!o,r.updateIndex(r.$index+o)},s=this,a=t?i-1:0;t?a>=0:a<i;t?a--:a++)r(a);this.shiftExtremum(-e.length,t),n&&(this.items=(0,o.ev)([],(0,o.CR)(this.items),!1)),this.cache.removeItems(e,t)},e.prototype.fillEmpty=function(e,t,i,n,r){if(!this.checkCall.fillEmpty(e,t,i))return!1;var o=Number.isInteger(t),s=o?t:i,a=n?e.length:o?1:0;return this.items=e.map((function(e,t){return r(s+t+(o?0:1)-a,e)})),this._absMinIndex=this.items[0].$index,this._absMaxIndex=this.items[this.size-1].$index,this.startIndex<=this.absMinIndex?this.startIndex=this.absMinIndex:this.startIndex>this.absMaxIndex&&(this.startIndex=this.absMaxIndex),!0},e.prototype.updateItems=function(e,t,i,n){if(!this.size||Number.isNaN(this.firstIndex))return{trackedIndex:NaN,toRemove:[]};for(var r=i,s=n?this.lastIndex:this.firstIndex,a=[],c=n?-1:1,l=this.size-1,u=new Map,f=Array.prototype[n?"unshift":"push"],d=function(l){var d=h.items[l];u.set(d.$index,d);var p=e(d);if(!p||Array.isArray(p)&&!p.length)return d.toRemove=!0,r+=d.$index>=i?n?1:0:n?0:-1,h.shiftExtremum(-1,n),"continue";if(!Array.isArray(p))return d.updateIndex(s),f.call(a,d),s+=c,"continue";d.$index<i?r+=n?0:p.length-1:d.$index>i&&(r+=n?1-p.length:0);var g=!0,m=[];(n?(0,o.ev)([],(0,o.CR)(p),!1).reverse():p).forEach((function(e,n){var o;d.data===e?(i===d.$index&&(r=s+n*c),d.updateIndex(s+n*c),o=d,g=!1):(o=t(s+n*c,e)).toInsert=!0,f.call(m,o)})),d.toRemove=g,f.call.apply(f,(0,o.ev)([a],(0,o.CR)(m),!1)),s+=c*p.length,p.length>1&&h.shiftExtremum(p.length-1,n)},h=this,p=n?l:0;n?p>=0:p<=l;p+=c)d(p);var g=this.items.filter((function(e){return e.toRemove})),m=Array.from(u).map((function(e){var t=(0,o.CR)(e,2),i=t[0],n=t[1];return{$index:i,size:n.size,toRemove:n.toRemove}})).sort((function(e,t){return e.$index-t.$index}));return this.items=a,this.cache.updateSubset(m,a,n),this.finiteAbsMinIndex===this.finiteAbsMaxIndex?r=NaN:r>this.finiteAbsMaxIndex?r=this.finiteAbsMaxIndex:r<this.finiteAbsMinIndex&&(r=this.finiteAbsMinIndex),{trackedIndex:r,toRemove:g}},e.prototype.cacheItem=function(e){this.cache.add(e)},e.prototype.getFirstVisibleItemIndex=function(){for(var e=this.items.length,t=0;t<e;t++)if(!this.items[t].invisible)return t;return-1},e.prototype.getLastVisibleItemIndex=function(){for(var e=this.items.length-1;e>=0;e--)if(!this.items[e].invisible)return e;return-1},e.prototype.getFirstVisibleItem=function(){var e=this.getFirstVisibleItemIndex();if(e>=0)return this.items[e]},e.prototype.getLastVisibleItem=function(){var e=this.getLastVisibleItemIndex();if(e>=0)return this.items[e]},e.prototype.getEdgeVisibleItem=function(e,t){return e===(t?a.backward:a.forward)?this.getLastVisibleItem():this.getFirstVisibleItem()},e.prototype.getVisibleItemsCount=function(){return this.items.reduce((function(e,t){return e+(t.invisible?0:1)}),0)},e.prototype.getSizeByIndex=function(e){return this.cache.getSizeByIndex(e)},e.prototype.checkDefaultSize=function(){return this.cache.recalculateDefaultSize()},e}(),Dt=function(){function e(e){this.total=e,this.isInitial=!1,this.busy=new s(!1)}return Object.defineProperty(e.prototype,"first",{get:function(){return 0===this.count},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.isInitial=!1,this.count++,this.total++,this.busy.set(!1)},e.prototype.start=function(){this.busy.set(!0)},e.prototype.dispose=function(){this.busy.dispose()},e}(),_t=function(){function e(e,t){var i=t?t.count:1,n=t?t.innerLoop.count:0;this.instanceIndex=e,this.innerLoop=new Dt(n),this.interrupter=null,this.busy=new s(!1),this.end(i)}return Object.defineProperty(e.prototype,"loopId",{get:function(){return"".concat(this.instanceIndex,"-").concat(this.count,"-").concat(this.innerLoop.total)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loopIdNext",{get:function(){return"".concat(this.instanceIndex,"-").concat(this.count,"-").concat(this.innerLoop.total+1)},enumerable:!1,configurable:!0}),e.prototype.start=function(e,t){this.isInitial=e,this.initiator=t,this.innerLoop.isInitial=e,this.innerLoop.count=0,this.interrupter=null,this.busy.set(!0)},e.prototype.end=function(e){this.count=e,this.isInitial=!1,this.busy.set(!1)},e.prototype.dispose=function(e){e&&this.busy.dispose(),this.innerLoop.dispose()},e}(),Ut=function(){function e(){this.reset()}return e.prototype.reset=function(){this.startDelta=0,this.before=0},e}(),Wt=function(){function e(){this.reset()}return e.prototype.reset=function(){this.index=NaN,this.indexBuffer=NaN,this.position=NaN},e}(),Zt=function(){function e(){this.reset()}return e.prototype.reset=function(){this.index=NaN,this.indexBuffer=NaN},e}(),Gt=function(){function e(){this.reset()}return e.prototype.reset=function(){this.index=NaN,this.delta=0},e}(),qt=function(){function e(e){this.directionPriority=e,this.callCount=0,this.positions=new Ut,this.first=new Wt,this.last=new Zt,this.firstVisible=new Gt,this.reset()}return e.prototype.reset=function(){this._newItemsData=null,this.items=[],this.positions.reset(),this.first.reset(),this.last.reset(),this.firstVisible.reset(),this.hasAnotherPack=!1,this.direction=null,this.cancel=null,this.simulate=!1,this.isCheck=!1,this.doRemove=!1},Object.defineProperty(e.prototype,"newItemsData",{get:function(){return this._newItemsData},set:function(e){this._newItemsData=e,e&&e.length&&this.callCount++},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shouldFetch",{get:function(){return!!this.count},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNewItems",{get:function(){return!(!this._newItemsData||!this._newItemsData.length)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.first.index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return isNaN(this.first.index)||isNaN(this.last.index)?0:this.last.index-this.first.index+1},enumerable:!1,configurable:!0}),e.prototype.shouldCheckPreSizeExpectation=function(e){if(this.directionPriority===a.backward)return!1;var t=this.items[this.items.length-1];return t&&t.$index<e},e.prototype.startSimulate=function(e){this.simulate=!0,this._newItemsData=e.map((function(e){return e.data})),this.items=e,this.hasAnotherPack=!1},e.prototype.stopSimulate=function(){this.simulate=!1,this.isCheck=!1,this.doRemove=!1},e.prototype.fill=function(e,t){this.startSimulate(e),this.first.index=e[0].$index,this.last.index=e[e.length-1].$index,this.direction=a.forward,this.firstVisible.index=t,this.firstVisible.delta=0},e.prototype.check=function(e){this.startSimulate(e),this.last.index=e[0].$index,this.first.index=e[e.length-1].$index,this.isCheck=!0},e.prototype.update=function(e,t,i,n){this.startSimulate(i),this.firstVisible.index=e,this.firstVisible.delta=t,this.doRemove=n.length>0},e}(),Xt=function(){function e(){this.callCount=0,this.reset()}return Object.defineProperty(e.prototype,"force",{get:function(){return this.forceForward||this.forceBackward},enumerable:!1,configurable:!0}),e.prototype.reset=function(e){this.doClip=!1,e||(this.forceForward=!1,this.forceBackward=!1)},e}(),Ht=function(){function e(){this.reset()}return Object.defineProperty(e.prototype,"noSize",{get:function(){return this.sizeBefore===this.sizeAfter},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.sizeBefore=0,this.sizeAfter=0,this.positionBefore=0,this.cancel=null},e}(),Yt=function(){function e(){this.reset()}return e.prototype.reset=function(){this.previous=null,this.current=null,this.syntheticPosition=null,this.syntheticFulfill=!1,this.positionBeforeAsync=null,this.positionBeforeAdjust=null,this.positionAfterAdjust=null,this.stop()},e.prototype.stop=function(){this.scrollTimer&&(clearTimeout(this.scrollTimer),this.scrollTimer=null),this.cancelAnimation&&(this.cancelAnimation(),this.cancelAnimation=null)},e.prototype.hasPositionChanged=function(e){var t=this.positionBeforeAdjust,i=this.positionAfterAdjust;return null===t||t!==e||null===i||i!==e},e}(),Jt=function(){function e(e,t,i){this.packageInfo=e,this.settings=t,this.initTime=Number(new Date),this.cycle=new _t(this.settings.instanceIndex,i?i.cycle:void 0),this.fetch=new qt(t.directionPriority),this.clip=new Xt,this.render=new Ht,this.scroll=new Yt}return Object.defineProperty(e.prototype,"time",{get:function(){return Number(new Date)-this.initTime},enumerable:!1,configurable:!0}),e.prototype.startWorkflowCycle=function(e,t){this.cycle.start(e,t)},e.prototype.endWorkflowCycle=function(e){this.cycle.end(e)},e.prototype.startInnerLoop=function(){var e=this,t=e.cycle,i=e.scroll,n=e.fetch,r=e.render,s=e.clip;return t.innerLoop.start(),i.positionBeforeAsync=null,n.simulate||n.reset(),s.reset(s.force),r.reset(),(0,o.pi)({},t.innerLoop.first?{process:t.initiator,doRender:n.simulate&&n.items.length>0}:{})},e.prototype.endInnerLoop=function(){var e=this,t=e.fetch,i=e.clip,n=e.render,r=e.cycle;t.stopSimulate(),i.reset(!0),t.cancel&&(t.cancel(),t.cancel=null),n.cancel&&(n.cancel(),n.cancel=null),r.innerLoop.done()},e.prototype.dispose=function(){this.scroll.stop(),this.cycle.dispose(),this.endInnerLoop()},e}(),Qt=x(),Kt=function(e,t){return"object"==typeof e&&null!==e&&Object.prototype.hasOwnProperty.call(e,t)},ei=function(e,t,i){var n=t;if(!Kt(t,"items")){var r=Array.isArray(t)?t:[t];n=e?{items:r,bof:i}:{items:r,eof:i}}return n},ti=function(){function e(e,t,i){var s=this;this.source={},this.box={},this.demand={},this.wanted={},this.getWorkflow=t,this.logger=i,this.relax$=null,this.relaxRun=null,this.reloadCounter=0;var a=e&&y.get(e.id)||{},c=e?Qt.map((function(t){var i=e[t.name];if(e.augmented){var n=a[t.name];n&&(i=n.default)}return(0,o.pi)((0,o.pi)({},t),{value:i})})):x();Object.entries(a).forEach((function(e){var t=(0,o.CR)(e,2),i=t[0],n=t[1],r=c.find((function(e){return e.name===i}));r&&n&&(r.value=n.default)})),c.filter((function(e){var t=e.type,i=e.permanent;return t===r.Scalar&&i})).forEach((function(e){var t=e.name,i=e.value;return Object.defineProperty(s,t,{configurable:!0,get:function(){return i}})})),c.filter((function(e){return e.type===r.Reactive})).forEach((function(e){var t=e.name,i=e.value;s.source[t]=i,Object.defineProperty(s,t,{configurable:!0,get:function(){var e=Qt.find((function(e){var i=e.wanted,n=e.reactive;return i&&n===t}));return e&&(s.wanted[e.name]=!0),s.source[t]}})})),c.filter((function(e){return e.type===r.Scalar&&!!e.reactive})).forEach((function(e){var t=e.name,i=e.value,n=e.reactive,r=e.wanted;r&&(s.wanted[t]=!1),s.box[t]=i,Object.defineProperty(s,t,{configurable:!0,set:function(e){if(e!==s.box[t]){s.box[t]=e,s.source[n].set(e);var i=a[n];i&&i.emit(i.source,e)}},get:function(){return r&&(s.wanted[t]=!0),s.box[t]}})})),c.filter((function(e){return e.type===r.Scalar&&e.onDemand})).forEach((function(e){var t=e.name,i=e.value;s.demand[t]=i,Object.defineProperty(s,t,{configurable:!0,get:function(){return s.demand[t]}})})),e&&(c.forEach((function(t){var i=t.name,o=t.type,c=t.value,l=t.permanent,u=s[i];o===r.Function?u=u.bind(s):o===r.WorkflowRunner?u=s.getPromisifiedMethod(u,c):o===r.Reactive&&a[i]?u=e[i]:i===n.augmented&&(u=!0),Object.defineProperty(e,i,{configurable:!0,get:function(){return l||o!==r.Scalar?u:s[i]}})})),this.externalContext=e)}return Object.defineProperty(e.prototype,"workflow",{get:function(){return this.getWorkflow()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reloadCount",{get:function(){return this.reloadCounter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reloadId",{get:function(){return this.id+"."+this.reloadCounter},enumerable:!1,configurable:!0}),e.prototype.getPromisifiedMethod=function(e,t){var i=this;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return i.relax$?new Promise((function(t){i.relax$&&i.relax$.once((function(e){return t(e)})),e.apply(i,n)})):t.apply(i,n)}},e.prototype.initialize=function(e,t,i,r){var o=this;if(Object.defineProperty(this.demand,n.itemsCount,{get:function(){return e.getVisibleItemsCount()}}),Object.defineProperty(this.demand,n.bufferInfo,{get:function(){return{firstIndex:e.firstIndex,lastIndex:e.lastIndex,minIndex:e.minIndex,maxIndex:e.maxIndex,absMinIndex:e.absMinIndex,absMaxIndex:e.absMaxIndex,defaultSize:e.defaultSize}}}),this.bof=e.bof.get(),e.bof.on((function(e){return o.bof=e})),this.eof=e.eof.get(),e.eof.on((function(e){return o.eof=e})),Object.defineProperty(this.demand,n.packageInfo,{get:function(){return t.packageInfo}}),this.loopPending=t.cycle.innerLoop.busy.get(),t.cycle.innerLoop.busy.on((function(e){return o.loopPending=e})),this.isLoading=t.cycle.busy.get(),t.cycle.busy.on((function(e){return o.isLoading=e})),this.logger=i,r){this.relax$||(this.relax$=new s);var a=this.relax$;r.on((function(e){var t=e.status,i=e.payload,n=function(){};t===ae.start?n=o.isLoading$.on((function(e){e||(n(),a.set({success:!0,immediate:!1,details:null}))})):t!==ae.done&&t!==ae.error||(n(),a.set({success:t!==ae.error,immediate:!0,details:t===ae.error&&i?String(i.error):null}))}))}this.init=!0},e.prototype.dispose=function(){var e=this;this.relax$&&this.relax$.dispose(),this.externalContext&&this.resetContext(),Object.getOwnPropertyNames(this).forEach((function(t){delete e[t]}))},e.prototype.resetContext=function(){var e=this,t=y.get(this.externalContext.id);Qt.forEach((function(i){var n=i.type,o=i.permanent,s=i.name,a=i.value;if(n===r.Reactive||o||Object.defineProperty(e.externalContext,s,{configurable:!0,get:function(){return a}}),n===r.Reactive&&t){var c=t[s];c&&(c.default.reset(),c.emit(c.source,c.default.get()))}}))},e.prototype.reset=function(e){this.reloadCounter++,this.logger.logAdapterMethod("reset",e," of ".concat(this.reloadId)),this.workflow.call({process:se.reset,status:ae.start,payload:{options:e}})},e.prototype.reload=function(e){this.reloadCounter++,this.logger.logAdapterMethod("reload",e," of ".concat(this.reloadId)),this.workflow.call({process:se.reload,status:ae.start,payload:{options:e}})},e.prototype.append=function(e,t){var i=ei(!1,e,t);this.logger.logAdapterMethod("append",[i.items,i.eof]),this.workflow.call({process:se.append,status:ae.start,payload:{options:i}})},e.prototype.prepend=function(e,t){var i=ei(!0,e,t);this.logger.logAdapterMethod("prepend",[i.items,i.bof]),this.workflow.call({process:se.prepend,status:ae.start,payload:{options:i}})},e.prototype.check=function(){this.logger.logAdapterMethod("check"),this.workflow.call({process:se.check,status:ae.start})},e.prototype.remove=function(e){e=function(e){return Kt(e,"predicate")||Kt(e,"indexes")||(e={predicate:e}),e}(e),this.logger.logAdapterMethod("remove",e),this.workflow.call({process:se.remove,status:ae.start,payload:{options:e}})},e.prototype.clip=function(e){this.logger.logAdapterMethod("clip",e),this.workflow.call({process:se.clip,status:ae.start,payload:{options:e}})},e.prototype.insert=function(e){this.logger.logAdapterMethod("insert",e),this.workflow.call({process:se.insert,status:ae.start,payload:{options:e}})},e.prototype.replace=function(e){this.logger.logAdapterMethod("replace",e),this.workflow.call({process:se.replace,status:ae.start,payload:{options:e}})},e.prototype.update=function(e){this.logger.logAdapterMethod("update",e),this.workflow.call({process:se.update,status:ae.start,payload:{options:e}})},e.prototype.fix=function(e){this.logger.logAdapterMethod("fix",e),this.workflow.call({process:se.fix,status:ae.start,payload:{options:e}})},e.prototype.relaxUnchained=function(e,t){var i=this,n=function(){return"function"==typeof e&&t===i.reloadId&&e()};return this.isLoading||n(),new Promise((function(e){i.isLoading?i.isLoading$.once((function(){n(),e(!1)})):e(!0)})).then((function(e){var n=t===i.reloadId;return i.logger.log((function(){return n?void 0:"relax promise cancelled due to ".concat(t," != ").concat(i.reloadId)})),{immediate:e,success:n,details:n?null:"Interrupted by reload or reset"}}))},e.prototype.relax=function(e){var t=this,i=this.reloadId;return this.logger.logAdapterMethod("relax",e," of ".concat(i)),this.init?this.relaxRun=this.relaxRun?this.relaxRun.then((function(){return t.relaxUnchained(e,i)})):this.relaxUnchained(e,i).then((function(e){return t.relaxRun=null,e})):Promise.resolve(h)},e.prototype.showLog=function(){this.logger.logAdapterMethod("showLog"),this.logger.logForce()},e}(),ii=0,ni=function(){function e(e){var t=e.datasource,i=e.consumer,n=e.element,r=e.workflow,o=e.Routines,s=e.scroller,a=D(t,H).params.get;if(!a.isValid)throw new Error("".concat("Invalid datasource:"," ").concat(a.errors[0]));var c=s?s.state.packageInfo:{consumer:i,core:b};n=s?s.routines.element:n,r=s?s.workflow:r,this.workflow=r,this.settings=new it(t.settings,t.devSettings,++ii),this.logger=new Ot(this,c,t.adapter),this.routines=new Pt(n,this.settings,o),this.state=new Jt(c,this.settings,s?s.state:void 0),this.buffer=new Lt(this.settings,r.onDataChanged,this.logger),this.viewport=new Ct(this.settings,this.routines,this.state,this.logger),this.logger.object("vscroll settings object",this.settings,!0),this.initDatasource(t,s)}return e.prototype.initDatasource=function(e,t){var i=this;if(t)return this.datasource=e,void(this.adapter=t.adapter);var n=e instanceof S,r=!n&&!this.settings.adapter;if(n)this.datasource=e;else{var o=z((function(){return{mock:r}}));this.datasource=new o(e),this.settings.adapter&&(e.adapter=this.datasource.adapter)}var s=r?null:this.datasource.adapter;this.adapter=new ti(s,(function(){return i.workflow}),this.logger)},e.prototype.init=function(e){this.viewport.reset(this.buffer.startIndex),this.logger.stat("initialization"),this.adapter.initialize(this.buffer,this.state,this.logger,e)},e.prototype.dispose=function(e){e&&this.adapter.dispose(),this.buffer.dispose(),this.state.dispose()},e.prototype.finalize=function(){},e}(),ri=function(){function e(e){var t=this,i=e.element,n=e.datasource,r=e.consumer,o=e.run,a=e.Routines;this.isInitialized=!1,this.initTimer=null,this.adapterRun$=new s,this.cyclesDone=0,this.interruptionCount=0,this.errors=[],this.offScroll=function(){return null},this.propagateChanges=o,this.stateMachineMethods={run:this.runProcess(),interrupt:this.interrupt.bind(this),done:this.done.bind(this),onError:this.onError.bind(this)},this.scroller=new ni({element:i,datasource:n,consumer:r,workflow:this.getUpdater(),Routines:a}),this.scroller.settings.initializeDelay?this.initTimer=setTimeout((function(){t.initTimer=null,t.init()}),this.scroller.settings.initializeDelay):this.init()}return e.prototype.init=function(){var e=this;this.scroller.init(this.adapterRun$),this.isInitialized=!0,this.callWorkflow({process:oe.init,status:ae.start});var t=this.scroller.routines;this.offScroll=t.onScroll((function(t){return e.callWorkflow({process:oe.scroll,status:ae.start,payload:{event:t}})}))},e.prototype.changeItems=function(e){this.propagateChanges(e)},e.prototype.callWorkflow=function(e){if(this.isInitialized){var t=e.process,i=e.status;t&&t.startsWith("adapter")&&i!==ae.next&&this.adapterRun$.set(e),this.process(e)}},e.prototype.getUpdater=function(){return{call:this.callWorkflow.bind(this),onDataChanged:this.changeItems.bind(this)}},e.prototype.process=function(e){var t=e.status,i=e.process,n=e.payload;this.scroller.settings.logProcessRun&&this.scroller.logger.log((function(){return(0,o.ev)((0,o.ev)((0,o.ev)(["%cfire%c"],["color: #cc7777;","color: #000000;"],!1),[i,'"'.concat(t,'"')],!1),(0,o.CR)(void 0!==n?[n]:[]),!1)})),this.scroller.logger.logProcess(e),i===oe.end&&this.scroller.finalize(),function(e){var t=e.input,i=t.process,n=t.status,r=t.payload,s=void 0===r?{}:r,a=e.methods,c=a.run,l=a.interrupt,u=a.done,f=a.onError;if(n===ae.error)return f(i,s),void(i.startsWith("adapter")||c(Et)(s));var d=s.options;switch(i){case oe.init:n===ae.start&&c(st)(i),n===ae.next&&c(bt)();break;case oe.scroll:n===ae.start&&c(at)(s),n===ae.next&&c(st)(i);break;case se.reset:case se.reload:n===ae.start&&(i===se.reset?c(ct)(d):c(lt)(d)),n===ae.next&&(l((0,o.pi)({process:i},s)),s.finalize?c(Et)():c(st)(i));break;case se.append:case se.prepend:n===ae.start&&c(ht)({process:i,options:d}),n===ae.next&&c(st)(i);break;case se.check:n===ae.start&&c(pt)(),n===ae.next&&c(st)(i);break;case se.remove:n===ae.start&&c(gt)(d),n===ae.next&&c(st)(i);break;case se.clip:n===ae.start&&c(mt)(d),n===ae.next&&c(st)(i);break;case se.insert:n===ae.start&&c(dt)(d),n===ae.next&&c(st)(i);break;case se.replace:n===ae.start&&c(vt)(d),n===ae.next&&c(st)(i);break;case se.update:n===ae.start&&c(ft)(d),n===ae.next&&c(st)(i);break;case se.fix:n===ae.start&&c(yt)(d),n===ae.next&&c(st)(i);break;case oe.start:switch(s.process){case se.append:case se.insert:case se.replace:case se.update:s.doRender?c(zt)():c(Vt)();break;case se.check:c(zt)();break;case se.remove:c(Vt)();break;default:c(wt)()}break;case oe.preFetch:n===ae.next&&(s.process===se.clip?c(Mt)():c(It)()),n===ae.done&&c(Et)();break;case oe.fetch:c(St)();break;case oe.postFetch:n===ae.next&&c(zt)(),n===ae.done&&c(Et)();break;case oe.render:if(n===ae.next)switch(s.process){case se.append:case se.check:case se.insert:case se.replace:case se.update:c(Vt)();break;default:c(Mt)()}n===ae.done&&c(Et)();break;case oe.preClip:s.doClip?c(Nt)():c(Vt)();break;case oe.clip:c(Vt)();break;case oe.adjust:c(Et)();break;case oe.end:if(n===ae.next)switch(s.process){case se.reset:case se.reload:u(),c(st)(s.process);break;default:c(bt)()}n===ae.done&&u()}}({input:e,methods:this.stateMachineMethods})},e.prototype.runProcess=function(){var e=this;return function(t){var i=t.run,n=t.process,r=t.name;return function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];e.scroller.settings.logProcessRun&&e.scroller.logger.log((function(){return(0,o.ev)((0,o.ev)((0,o.ev)(["%crun%c"],["color: #333399;","color: #000000;"],!1),[n||r],!1),(0,o.CR)(t),!1)})),i.apply(void 0,(0,o.ev)([e.scroller],(0,o.CR)(t),!1))}}},e.prototype.onError=function(e,t){var i=t&&String(t.error)||"",n=this.scroller.state,r=n.time,o=n.cycle;this.errors.push({process:e,message:i,time:r,loop:o.loopIdNext}),this.scroller.logger.logError(i)},e.prototype.interrupt=function(e){var t=this,i=e.process,n=e.finalize,r=e.datasource;if(n){var o=this.scroller,s=o.workflow,a=o.logger;s.call=function(e){return a.log("[skip wf call]")},s.call.interrupted=!0,this.scroller.workflow=this.getUpdater(),this.interruptionCount++,a.log((function(){return"workflow had been interrupted by the ".concat(i," process (").concat(t.interruptionCount,")")}))}r&&this.scroller.adapter.relax((function(){t.scroller.logger.log("new Scroller instantiation");var e=new ni({datasource:r,scroller:t.scroller});t.scroller.dispose(),t.scroller=e,t.scroller.init()}))},e.prototype.done=function(){var e=this.scroller,t=e.state,i=e.logger;this.cyclesDone++,i.logCycle(!1),t.endWorkflowCycle(this.cyclesDone+1),this.finalize()},e.prototype.dispose=function(){var e=this;this.initTimer&&clearTimeout(this.initTimer),this.offScroll(),this.adapterRun$.dispose(),this.scroller.dispose(!0),Object.getOwnPropertyNames(this).forEach((function(t){delete e[t]}))},e.prototype.finalize=function(){},e}()}}]);
//# sourceMappingURL=vendors.js.map